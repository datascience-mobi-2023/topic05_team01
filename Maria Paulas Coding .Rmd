---
title: "Maria Paula Coding"
output: html_document
date: "2023-05-29"
---

# MY AIM: The overall objective is to investigate whether there's a relationship between genetic variations in different cancer cell lines and their response to various treatments.



```{r}
library(ggplot2)
library(ggforce)
library(cluster)
```


```{r}
prism.cnv_celllines <- prism.cnv[rownames(prism.cnv) %in% cancer.celllines.v, ]
```




```{r}
# Average CNV for each gene across all cell lines
avg_cnv <- rowMeans(prism.cnv_celllines )

View (avg_cnv)

```




```{r}
# average drug response for each treatment across all cell lines
avg_response <- rowMeans(prism_celllines_numeric)

```




```{r}
# data frame with the averages
avg.cnv_response.df <- data.frame (avg_cnv, avg_response)
```



```{r}
# Create scatter plot

plot(avg.cnv_response.df[["avg_cnv"]], avg.cnv_response.df[["avg_response"]], 
     xlab = "Average Copy Number Variation", 
     ylab = "Average Drug Response",
     main = "Scatterplot of Average CNV vs. Average Drug Response",
     pch = 20) 

```



```{r}
correlation <- cor(avg.cnv_response.df[["avg_cnv"]], avg.cnv_response.df[["avg_response"]])
print(correlation)

# The correlation coefficient of 0.06630813 indicates a very weak positive correlation between the average CNV (Copy Number Variation) and the average drug response.

# This means changes in average CNV are not associated with significant changes in the average drug response.

```

# Conclusion: To better understand the relationship between CNV and drug response, a more advanced analysis would be needed, looking at individual genes and treatments


# General Observations: I want to create two date set with Pris.treat, where there are oncology and non oncology treatments as control gropus and then specificallly for gastric cancer cell treatments 



# Gastric: oncology gastric and non oncology gastric 

```{r}

# Filter for oncology treatments related to gastric or gastrointestinal cancer
contains_gastric_or_gastrointestinal <- grepl("gastric|gastrointestinal", prism.treat$indication, ignore.case = TRUE)
contains_oncology <- grepl("oncology", prism.treat$disease.area, ignore.case = TRUE)


gastric_oncology_treatments <- prism.treat[contains_gastric_or_gastrointestinal & contains_oncology, ]

```


```{r}
# Extract treatment IDs for gastric/gastrointestinal oncology treatments
gastric.oncology_treatment_ids <- rownames(gastric_oncology_treatments)

# Filter prism data for these treatment IDs
gastric_oncology_responses <- prism[, colnames(prism) %in% gastric.oncology_treatment_ids]


```

```{r}
# Impute NA values with column means
gastric_oncology_responses <- as.data.frame(lapply(gastric_oncology_responses, function(x) ifelse(is.na(x), mean(x, na.rm = TRUE), x)))

```



```{r}

avg_response_oncology_gastric <- rowMeans(gastric_oncology_responses)

```




Gastric non oncology 

```{r}
# Filter for non-oncology treatments related to gastric or gastrointestinal cancer
gastric_non_oncology_treatments <- prism.treat[contains_gastric_or_gastrointestinal & !contains_oncology, ]

```
```{r}

# Extract treatment IDs for gastric/gastrointestinal non-oncology treatments
gastric.non_oncology_treatment_ids <- rownames(gastric_oncology_treatments)

# Filter prism data for these treatment IDs
gastric_non_oncology_responses <- prism[, colnames(prism) %in% gastric.non_oncology_treatment_ids]

```



```{r}

# Impute NA values with column means
gastric_non_oncology_responses <- as.data.frame(lapply(gastric_non_oncology_responses, function(x) ifelse(is.na(x), mean(x, na.rm = TRUE), x)))

```




```{r}

avg_response_non_oncology_gastric <- rowMeans(gastric_non_oncology_responses)

```


```{r}
# Calculate the fold change for each cell line

fold_changes.ongological <- avg_response_non_oncology_gastric / avg_response_oncology_gastric

dim(avg_response_non_oncology_gastric)
dim(avg_response_oncology)

```


```{r}
# Convert the fold_changes to a data frame for plotting
fold_changes_gastric_df <- data.frame(cell_line = names(fold_changes), fold_change = fold_changes.ongological)

# Sort the dataframe by fold_change 
fold_changes_gastric_df <- fold_changes_gastric_df [order(fold_changes_gastric_df$fold_change, decreasing = TRUE), ]

# Plot the fold changes
barplot(fold_changes_gastric_df$fold_change, names.arg = fold_changes_gastric_df$cell_line, las = 2, cex.names = 0.5, main = "Fold Changes of Non-Oncology Treatments Relative to Oncology Treatments", xlab = "Cell Lines", ylab = "Fold Change")
```





```{r}
# Filter for oncology treatments related to gastric or gastrointestinal cancer
contains_gastric_or_gastrointestinal <- grepl("gastric|gastrointestinal", prism.treat$indication, ignore.case = TRUE)
contains_oncology <- grepl("oncology", prism.treat$disease.area, ignore.case = TRUE)

gastric_oncology_treatments <- prism.treat[contains_gastric_or_gastrointestinal & contains_oncology, ]

# Extract treatment IDs for gastric/gastrointestinal oncology treatments
gastric_oncology_treatment_ids <- rownames(gastric_oncology_treatments)

# Filter prism data for these treatment IDs
gastric_oncology_responses <- prism[, colnames(prism) %in% gastric_oncology_treatment_ids]

# Impute NA values with column means
gastric_oncology_responses <- as.data.frame(lapply(gastric_oncology_responses, function(x) ifelse(is.na(x), mean(x, na.rm = TRUE), x)))

avg_response_oncology_gastric <- rowMeans(gastric_oncology_responses)

# Filter for non-oncology treatments related to gastric or gastrointestinal cancer
gastric_non_oncology_treatments <- prism.treat[contains_gastric_or_gastrointestinal & !contains_oncology, ]

# Extract treatment IDs for gastric/gastrointestinal non-oncology treatments
gastric_non_oncology_treatment_ids <- rownames(gastric_non_oncology_treatments) # Fixed this line

# Filter prism data for these treatment IDs
gastric_non_oncology_responses <- prism[, colnames(prism) %in% gastric_non_oncology_treatment_ids]

# Impute NA values with column means
gastric_non_oncology_responses <- as.data.frame(lapply(gastric_non_oncology_responses, function(x) ifelse(is.na(x), mean(x, na.rm = TRUE), x)))

avg_response_non_oncology_gastric <- rowMeans(gastric_non_oncology_responses)

# Calculate the fold change for each cell line
pseudo_count <- 1e-9
fold_changes_oncological <- (avg_response_non_oncology_gastric + pseudo_count) / (avg_response_oncology_gastric + pseudo_count)

# Convert the fold_changes to a data frame for plotting
fold_changes_gastric_df <- data.frame(cell_line = names(fold_changes_oncological), fold_change = fold_changes_oncological)

# Sort the dataframe by fold_change 
fold_changes_gastric_df <- fold_changes_gastric_df[order(fold_changes_gastric_df$fold_change, decreasing = TRUE), ]

# Plot the fold changes
barplot

```


```{r}
# Check the lengths of fold_changes_oncological and its names
print(length(fold_changes_oncological))
print(length(names(fold_changes_oncological)))

# Check if avg_response_oncology_gastric and avg_response_non_oncology_gastric have names
print(length(names(avg_response_oncology_gastric)))
print(length(names(avg_response_non_oncology_gastric)))

# If the avg_response vectors have names, use them for the cell_line column
if (length(names(avg_response_oncology_gastric)) == length(fold_changes_oncological)) {
  cell_lines <- names(avg_response_oncology_gastric)
} else {
  # Provide a default value, or handle this case as needed
  cell_lines <- 1:length(fold_changes_oncological)
}

# Create the data frame using cell_lines for the cell_line column
fold_changes_gastric_df <- data.frame(cell_line = cell_lines, fold_change = fold_changes_oncological)

# Sort the dataframe by fold_change 
fold_changes_gastric_df <- fold_changes_gastric_df[order(fold_changes_gastric_df$fold_change, decreasing = TRUE), ]

# Plot the fold changes
barplot(fold_changes_gastric_df$fold_change, names.arg = fold_changes_gastric_df$cell_line, las = 2, cex.names = 0.5, main = "Fold Changes of Non-Oncology Treatments Relative to Oncology Treatments", xlab = "Cell Lines", ylab = "Fold Change")

```








```{r}
# Filter for oncology treatments related to gastric cancer
contains_gastric <- grepl("gastric", prism.treat$indication, ignore.case = TRUE)
contains_oncology <- grepl("oncology", prism.treat$disease.area, ignore.case = TRUE)

# Filtering for treatments that are both related to gastric cancer and are oncology treatments
gastric_oncology_treatments <- prism.treat[contains_gastric & contains_oncology, ]

# Extract treatment IDs for gastric oncology treatments
gastric_oncology_treatment_ids <- rownames(gastric_oncology_treatments)

# Filter prism data for these treatment IDs
gastric_oncology_responses <- prism[, colnames(prism) %in% gastric_oncology_treatment_ids]

# Impute NA values with column means
gastric_oncology_responses <- as.data.frame(lapply(gastric_oncology_responses, function(x) ifelse(is.na(x), mean(x, na.rm = TRUE), x)))

# Calculate average response for oncology treatments
avg_response_oncology_gastric <- rowMeans(gastric_oncology_responses)

# Now, for non-oncology treatments related to gastric cancer
gastric_non_oncology_treatments <- prism.treat[contains_gastric & !contains_oncology, ]

# Extract treatment IDs for gastric non-oncology treatments
gastric_non_oncology_treatment_ids <- rownames(gastric_non_oncology_treatments)

# Filter prism data for these treatment IDs
gastric_non_oncology_responses <- prism[, colnames(prism) %in% gastric_non_oncology_treatment_ids]

# Impute NA values with column means
gastric_non_oncology_responses <- as.data.frame(lapply(gastric_non_oncology_responses, function(x) ifelse(is.na(x), mean(x, na.rm = TRUE), x)))

# Calculate average response for non-oncology treatments
avg_response_non_oncology_gastric <- rowMeans(gastric_non_oncology_responses)


# Calculate the fold change for each cell line
fold_changes_oncological <- avg_response_non_oncology_gastric / avg_response_oncology_gastric

# Creating data frame for plotting
cell_line_names <- rownames(gastric_oncology_responses) # Use row names from the responses matrix
fold_changes_gastric_df <- data.frame(cell_line = cell_line_names, fold_change = fold_changes_oncological)

# Sort the dataframe by fold_change 
fold_changes_gastric_df <- fold_changes_gastric_df[order(fold_changes_gastric_df$fold_change, decreasing = TRUE), ]

# Plot the fold changes
barplot(fold_changes_gastric_df$fold_change, names.arg = fold_changes_gastric_df$cell_line, las = 2, cex.names = 0.5, main = "Fold Changes of Non-Oncology Treatments Relative to Oncology Treatments", xlab = "Cell Lines", ylab = "Fold Change")



```




```{r}
# Filter for oncology treatments related to gastric or gastrointestinal cancer
contains_gastric_or_gastrointestinal <- grepl("gastric|gastrointestinal", prism.treat$indication, ignore.case = TRUE)
contains_oncology <- grepl("oncology", prism.treat$disease.area, ignore.case = TRUE)

gastric_oncology_treatments <- prism.treat[contains_gastric_or_gastrointestinal & contains_oncology, ]
gastric_oncology_treatment_ids <- rownames(gastric_oncology_treatments)

gastric_oncology_responses <- prism[, colnames(prism) %in% gastric_oncology_treatment_ids]
gastric_oncology_responses <- as.data.frame(lapply(gastric_oncology_responses, function(x) ifelse(is.na(x), mean(x, na.rm = TRUE), x)))

avg_response_oncology_gastric <- rowMeans(gastric_oncology_responses)

# Gastric non oncology 
gastric_non_oncology_treatments <- prism.treat[contains_gastric_or_gastrointestinal & !contains_oncology, ]
gastric_non_oncology_treatment_ids <- rownames(gastric_non_oncology_treatments)

gastric_non_oncology_responses <- prism[, colnames(prism) %in% gastric_non_oncology_treatment_ids]
gastric_non_oncology_responses <- as.data.frame(lapply(gastric_non_oncology_responses, function(x) ifelse(is.na(x), mean(x, na.rm = TRUE), x)))

avg_response_non_oncology_gastric <- rowMeans(gastric_non_oncology_responses)

# Adding print statements for debug:
print(length(avg_response_oncology_gastric))
print(sum(is.na(avg_response_oncology_gastric)))
print(length(avg_response_non_oncology_gastric))
print(sum(is.na(avg_response_non_oncology_gastric)))

# Calculate the fold change for each cell line
fold_changes_oncological <- avg_response_non_oncology_gastric / avg_response_oncology_gastric

# Debug: print fold change values
print(head(fold_changes_oncological))

# Creating data frame for plotting
cell_line_names <- rownames(gastric_oncology_responses) # Use row names from the responses matrix
fold_changes_gastric_df <- data.frame(cell_line = cell_line_names, fold_change = fold_changes_oncological)

# Sort the dataframe by fold_change 
fold_changes_gastric_df <- fold_changes_gastric_df[order(fold_changes_gastric_df$fold_change, decreasing = TRUE), ]

# Plot the fold changes
barplot(fold_changes_gastric_df$fold_change, names.arg = fold_changes_gastric_df$cell_line, las = 2, cex.names = 0.5, main = "Fold Changes of Non-Oncology Treatments Relative to Oncology Treatments", xlab = "Cell Lines", ylab = "Fold Change")

```




# Hypotesis Test: 

```{r}
# Perform a t-test to test if there is a significant difference in average response
# between oncology treatments and non-oncology treatments for gastric cancer
t_test_result <- t.test(avg_response_non_oncology_gastric, avg_response_oncology_gastric)

# Output the result of the t-test
print(t_test_result)
```


# The extremely low p-value (< 2.2e-16) is a strong indicator that the difference in means between the two groups is statistically significant and not likely due to random chance.





# General, oncology and non oncology treatments 

```{r}

contains_cancer <- grepl("oncology", prism.treat$disease.area, ignore.case = TRUE)

# Subset the dataframe to include only the rows where the keyword is present

oncology_treatments <- prism.treat[contains_cancer, ]
```



```{r}
# Extract treatment IDs from row names of oncology_treatments
treatment_ids <- rownames(oncology_treatments)

# Subset prism based on treatment_ids
oncology_treatments_prism <- prism[, colnames(prism) %in% treatment_ids]

# Now selected_treatments_prism contains only the responses of the treatments in oncology_treatments

```

```{r}
# Replace NA values with zero in the entire dataframe

oncology_treatments_prism[is.na(oncology_treatments_prism)] <- 0

```



```{r}

str(oncology_treatments_prism)

```


```{r}
avg_response_oncology <- rowMeans(oncology_treatments_prism)


str(avg_response_oncology)
```







```{r}
# Filter rows that do not contain the keyword "oncology"
non_oncology_treatments <- prism.treat[!grepl("oncology", prism.treat$disease.area, ignore.case = TRUE), ]

# Extract treatment IDs from row names of non_oncology_treatments
non_oncology_treatment_ids <- rownames(non_oncology_treatments)

# Subset prism based on non_oncology_treatment_ids
non_oncology_treatments_prism <- prism[, colnames(prism) %in% non_oncology_treatment_ids]

# Now non_oncology_treatments_prism contains only the responses of the non-oncological treatments

```

```{r}
# Replace NA values with zero in the entire dataframe

non_oncology_treatments_prism[is.na(non_oncology_treatments_prism)] <- 0

```


```{r}
str(non_oncology_treatments_prism)
```


```{r}
avg_response_non_oncology <- rowMeans(non_oncology_treatments_prism)

```



```{r}
# Calculate the fold change for each cell line
fold_changes <- avg_response_non_oncology / avg_response_oncology

```


```{r}

# Convert the fold_changes to a data frame for easier plotting
fold_changes_df <- data.frame(cell_line = names(fold_changes), fold_change = fold_changes)

# Sort the dataframe by fold_change for a more organized plot
fold_changes_df <- fold_changes_df[order(fold_changes_df$fold_change, decreasing = TRUE), ]

# Plot the fold changes
barplot(fold_changes_df$fold_change, names.arg = fold_changes_df$cell_line, las = 3, cex.names = 0.5, main = "Fold Changes of Non-Oncology Treatments Relative to Oncology Treatments", xlab = "Cell Lines", ylab = "Fold Change")
```




```{r}
# Perform a t-test to test if there is a significant difference in average response
# between oncology treatments and non-oncology treatments for gastric cancer
t_test_result.general <- t.test(avg_response_non_oncology, avg_response_oncology)

# Output the result of the t-test
print(t_test_result.general)

```
# statistically significant difference in the average responses between the two groups.





```{r}

# list of target molecules, replace this with actual list
target_molecules <- c("mTor", "NHP2L1", "RPL10L", "RPL11", "RPL13A", "RPL15", "RPL19", "RPL23", "AURKB", "CDK2", "CDK4", "MTOR", "PIK3CA", "BRD2", "BRD3", "BRD4", "BCL2", "EGFR", "AURKA", "AURKB", "AURKC","BRD4", "JAK1", "JAK2", "JAK3", "TYK2", "HDAC1", "HDAC2", "HDAC3", "HDAC6","HDAC1","CDK1", "CDK2", "CDK5", "CDK9", "HDAC1", "HDAC2", "HDAC3", "HDAC4", "HDAC5", "HDAC6", "HDAC7","FGFR1", "FGFR2", "FGFR3", "FGFR4", "KDR","OPRL1","HDAC1", "HDAC10", "HDAC11", "HDAC2", "HDAC3", "HDAC4", "HDAC5","FLT3", "JAK1", "JAK2", "JAK3","XPO1","EGFR", "ERBB2","BRAF","SLC6A3","ABL1","BCR", "HSP90AA1", "RELA", "CDK1", "CDK4", "CDK9", "TOP1", "TOP2A","MELK", "AURKA", "HDAC1", "HDAC2", "HDAC3", "HDAC4", "HDAC5", "HDAC6", "HDAC7", "EGFR", "ERBB2", "ERBB4", "KIF11","KIF11","XPO1","TOP2A",
"MAPK8","ARF1", "CYTH2","GSK3B", "TUBB","HSP90AA1","CHEK1", "CHEK2",
"MTOR", "PDPK1", "PDPK1","TOP1")

Filtered_data.snv <- prism.snv[prism.snv$Hugo_Symbol %in% target_molecules, ]

```





```{r}
str(prism.snv)
```






