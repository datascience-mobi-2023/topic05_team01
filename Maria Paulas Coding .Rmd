---
title: "Maria Paula Coding"
output: html_document
date: "2023-05-29"
---

# MY AIM: The overall objective is to investigate whether there's a relationship between genetic variations in different cancer cell lines and their response to various treatments.

```{r}
library(ggplot2)
library(ggforce)
library(cluster)
```

```{r}
prism.cnv_celllines <- prism.cnv[rownames(prism.cnv) %in% cancer.celllines.v, ]
```

```{r}
# Average CNV for each gene across all cell lines
avg_cnv <- rowMeans(prism.cnv_celllines )

View (avg_cnv)

```

```{r}
# average drug response for each treatment across all cell lines
avg_response <- rowMeans(prism_celllines_numeric)

```

```{r}
# data frame with the averages
avg.cnv_response.df <- data.frame (avg_cnv, avg_response)
```

```{r}
# Create scatter plot

plot(avg.cnv_response.df[["avg_cnv"]], avg.cnv_response.df[["avg_response"]], 
     xlab = "Average Copy Number Variation", 
     ylab = "Average Drug Response",
     main = "Scatterplot of Average CNV vs. Average Drug Response",
     pch = 20) 

```

```{r}
correlation <- cor(avg.cnv_response.df[["avg_cnv"]], avg.cnv_response.df[["avg_response"]])
print(correlation)

# The correlation coefficient of 0.06630813 indicates a very weak positive correlation between the average CNV (Copy Number Variation) and the average drug response.

# This means changes in average CNV are not associated with significant changes in the average drug response.

```

# Conclusion: To better understand the relationship between CNV and drug response, a more advanced analysis would be needed, looking at individual genes and treatments

# General Observations: I want to create two date set with Pris.treat, where there are oncology and non oncology treatments as control gropus and then specificallly for gastric cancer cell treatments

# Gastric: oncology gastric and non oncology gastric

```{r}

# Filter for oncology treatments related to gastric or gastrointestinal cancer
contains_gastric_or_gastrointestinal <- grepl("gastric|gastrointestinal", prism.treat$indication, ignore.case = TRUE)
contains_oncology <- grepl("oncology", prism.treat$disease.area, ignore.case = TRUE)


gastric_oncology_treatments <- prism.treat[contains_gastric_or_gastrointestinal & contains_oncology, ]

```

```{r}
# Extract treatment IDs for gastric/gastrointestinal oncology treatments
gastric.oncology_treatment_ids <- rownames(gastric_oncology_treatments)

# Filter prism data for these treatment IDs
gastric_oncology_responses <- prism[, colnames(prism) %in% gastric.oncology_treatment_ids]


```

```{r}
# Impute NA values with column means
gastric_oncology_responses <- as.data.frame(lapply(gastric_oncology_responses, function(x) ifelse(is.na(x), mean(x, na.rm = TRUE), x)))

```

```{r}

avg_response_oncology_gastric <- rowMeans(gastric_oncology_responses)

```

Gastric non oncology

```{r}
# Filter for non-oncology treatments related to gastric or gastrointestinal cancer
gastric_non_oncology_treatments <- prism.treat[contains_gastric_or_gastrointestinal & !contains_oncology, ]

```

```{r}

# Extract treatment IDs for gastric/gastrointestinal non-oncology treatments
gastric.non_oncology_treatment_ids <- rownames(gastric_oncology_treatments)

# Filter prism data for these treatment IDs
gastric_non_oncology_responses <- prism[, colnames(prism) %in% gastric.non_oncology_treatment_ids]

```

```{r}

# Impute NA values with column means
gastric_non_oncology_responses <- as.data.frame(lapply(gastric_non_oncology_responses, function(x) ifelse(is.na(x), mean(x, na.rm = TRUE), x)))

```

```{r}

avg_response_non_oncology_gastric <- rowMeans(gastric_non_oncology_responses)

```

```{r}
# Calculate the fold change for each cell line

fold_changes.ongological <- avg_response_non_oncology_gastric / avg_response_oncology_gastric

dim(avg_response_non_oncology_gastric)
dim(avg_response_oncology)

```

```{r}
# Convert the fold_changes to a data frame for plotting
fold_changes_gastric_df <- data.frame(cell_line = names(fold_changes), fold_change = fold_changes.ongological)

# Sort the dataframe by fold_change 
fold_changes_gastric_df <- fold_changes_gastric_df [order(fold_changes_gastric_df$fold_change, decreasing = TRUE), ]

# Plot the fold changes
barplot(fold_changes_gastric_df$fold_change, names.arg = fold_changes_gastric_df$cell_line, las = 2, cex.names = 0.5, main = "Fold Changes of Non-Oncology Treatments Relative to Oncology Treatments", xlab = "Cell Lines", ylab = "Fold Change")
```





# Fold changes analysis between non-Oncology gastric Treatments Relative to Oncology gastric Treatments
```{r}
# Filter for oncology treatments related to gastric or gastrointestinal cancer
contains_gastric_or_gastrointestinal <- grepl("gastric|gastrointestinal", prism.treat$indication, ignore.case = TRUE)
contains_oncology <- grepl("oncology", prism.treat$disease.area, ignore.case = TRUE)

gastric_oncology_treatments <- prism.treat[contains_gastric_or_gastrointestinal & contains_oncology, ]

# Extract treatment IDs for gastric/gastrointestinal oncology treatments
gastric_oncology_treatment_ids <- rownames(gastric_oncology_treatments)

# Filter prism data for these treatment IDs
gastric_oncology_responses <- prism_gastric[, colnames(prism) %in% gastric_oncology_treatment_ids]

# Impute NA values with column means
gastric_oncology_responses <- as.data.frame(lapply(gastric_oncology_responses, function(x) ifelse(is.na(x), mean(x, na.rm = TRUE), x)))

avg_response_oncology_gastric <- rowMeans(gastric_oncology_responses)


# Filter for non-oncology treatments related to gastric or gastrointestinal cancer
gastric_non_oncology_treatments <- prism.treat[contains_gastric_or_gastrointestinal & !contains_oncology, ]

# Extract treatment IDs for gastric/gastrointestinal non-oncology treatments
gastric_non_oncology_treatment_ids <- rownames(gastric_non_oncology_treatments) # Fixed this line

# Filter prism data for these treatment IDs
gastric_non_oncology_responses <- prism_gastric[, colnames(prism) %in% gastric_non_oncology_treatment_ids]


# Impute NA values with column means
gastric_non_oncology_responses <- as.data.frame(lapply(gastric_non_oncology_responses, function(x) ifelse(is.na(x), mean(x, na.rm = TRUE), x)))

avg_response_non_oncology_gastric <- rowMeans(gastric_non_oncology_responses)

# Calculate the fold change for each cell line
pseudo_count <- 1e-9
fold_changes_oncological <- (avg_response_non_oncology_gastric + pseudo_count) / (avg_response_oncology_gastric + pseudo_count)

names(avg_response_oncology_gastric) <- gastric.cancer.celllines.v 


# Check the lengths of fold_changes_oncological and its names
print(length(fold_changes_oncological))
print(length(names(fold_changes_oncological)))

# Check if avg_response_oncology_gastric and avg_response_non_oncology_gastric have names
print(length(names(avg_response_oncology_gastric)))
print(length(names(avg_response_non_oncology_gastric)))

# If the avg_response vectors have names, use them for the cell_line column
if (length(names(avg_response_oncology_gastric)) == length(fold_changes_oncological)) {
  cell_lines <- names(avg_response_oncology_gastric)
} else {
  # Provide a default value, or handle this case as needed
  cell_lines <- 1:length(fold_changes_oncological)
}


# Create the data frame using cell_lines for the cell_line column
fold_changes_gastric_df <- data.frame(cell_line = cell_lines, fold_change = fold_changes_oncological)

# Sort the dataframe by fold_change 
fold_changes_gastric_df <- fold_changes_gastric_df[order(fold_changes_gastric_df$fold_change, decreasing = TRUE), ]

# Plot the fold changes
barplot(fold_changes_gastric_df$fold_change, names.arg = fold_changes_gastric_df$cell_line, las = 2, cex.names = 0.5, main = "Fold Changes Non-Oncology gastric Treatments Relative to Oncology gastric Treatments", xlab = "Cell Lines", ylab = "Fold Change")


library(ggplot2)

# Using ggplot2
ggplot(fold_changes_gastric_df, aes(x = reorder(cell_line, -fold_change), y = fold_change, fill = cell_line)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(title = "Fold Changes Non-Oncology gastric Treatments Relative to Oncology gastric Treatments",
       x = "Cell Lines",
       y = "Fold Change",
       fill = "Cell Line") +
  guides(fill=FALSE)  # This removes the legend




```





```{r}
# Check if the data is normally distributed
shapiro_test_oncology_gastric <- shapiro.test(avg_response_oncology_gastric)
shapiro_test_non_oncology_gastric <- shapiro.test(avg_response_non_oncology_gastric)

# Print the results
print(shapiro_test_oncology_gastric)
print(shapiro_test_non_oncology_gastric)

```

#For avg_response_oncology_gastric, the p-value is 0.9127, which is greater than 0.05. This indicates that the data does not significantly deviate from a normal distribution.

# For avg_response_non_oncology_gastric, the p-value is 0.06901, which is greater than 0.05. -> normally distributed




```{r}
t_test_result <- t.test(avg_response_oncology_gastric, avg_response_non_oncology_gastric)

# Print the result
print(t_test_result)

```

# This result suggests that there is a statistically significant difference in the responses of cell lines to non-oncology gastric treatments compared to oncology gastric treatments, as measured by the fold changes. P value < 0,05




```{r}
# Perform the Mann-Whitney U Test
mann_whitney_test_result <- wilcox.test(avg_response_non_oncology_gastric, avg_response_oncology_gastric)

# Print the results
print(mann_whitney_test_result)

```

# This result suggests that there is a statistically significant difference in the responses of cell lines to non-oncology gastric treatments compared to oncology gastric treatments, as measured by the fold changes < 0,05
 






```{r}
# Filter for oncology treatments related to gastric or gastrointestinal cancer
contains_gastric_or_gastrointestinal <- grepl("gastric|gastrointestinal", prism.treat$indication, ignore.case = TRUE)
contains_oncology <- grepl("oncology", prism.treat$disease.area, ignore.case = TRUE)

gastric_oncology_treatments <- prism.treat[contains_gastric_or_gastrointestinal & contains_oncology, ]
gastric_oncology_treatment_ids <- rownames(gastric_oncology_treatments)
gastric_oncology_responses <- prism_gastric[, colnames(prism_gastric) %in% gastric_oncology_treatment_ids]
gastric_oncology_responses_imputed <- as.data.frame(lapply(gastric_oncology_responses, function(x) ifelse(is.na(x), mean(x, na.rm = TRUE), x)))
avg_response_oncology_gastric <- rowMeans(gastric_oncology_responses_imputed, na.rm = TRUE)

#Repeat steps 2 and 3 for non-oncology treatments
non_oncology_treatments <- prism.treat[!contains_oncology, ]
non_oncology_treatment_ids <- rownames(non_oncology_treatments)
non_oncology_responses <- prism_gastric[, colnames(prism_gastric) %in% non_oncology_treatment_ids]
non_oncology_responses_imputed <- as.data.frame(lapply(non_oncology_responses, function(x) ifelse(is.na(x), mean(x, na.rm = TRUE), x)))
avg_response_non_oncology <- rowMeans(non_oncology_responses_imputed, na.rm = TRUE)


# Calculate the fold changes
pseudo_count <- 1e-9
fold_changes <- (avg_response_non_oncology + pseudo_count) / (avg_response_oncology_gastric + pseudo_count)
cell_lines <- rownames(prism_gastric)  # Assuming row names represent the cell lines

# Plot the fold changes
fold_changes_df <- data.frame(cell_line = cell_lines, fold_change = fold_changes)

# Load the necessary library
library(ggplot2)

# Define custom color palette
my_colors <- colorRampPalette(c("purple", "pink"))(length(unique(fold_changes_df$cell_line)))

# Create the plot
ggplot(fold_changes_df, aes(x = cell_line, y = fold_change, fill = cell_line)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = my_colors) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(x = "Cell Line", y = "Fold Change", title = "Fold Changes of Cell Line Responses")

```


```{r}
# Check if the data is normally distributed
shapiro_test_oncology_gastric <- shapiro.test(avg_response_oncology_gastric)
shapiro_test_non_oncology <- shapiro.test(avg_response_non_oncology)

# Print the results
print(shapiro_test_oncology_gastric)
print(shapiro_test_non_oncology)

```

# They are normally distributed, greater than 0.05 


```{r}
t_test_result_2 <- t.test(avg_response_oncology_gastric, avg_response_non_oncology)

# Print the result
print(t_test_result_2)

```

# P value is shorter than 0,05 -> diference is significant 


```{r}
# Perform the Mann-Whitney U Test
mann_whitney_test_result_2 <- wilcox.test(avg_response_oncology_gastric, avg_response_non_oncology)

# Print the results
print(mann_whitney_test_result_2)

```
# P value is shorter than 0,05 -> diference is significant 






# General, oncology and non oncology treatments

```{r}
# Filter for oncology treatments
contains_oncology <- grepl("oncology", prism.treat$disease.area, ignore.case = TRUE)
oncology_treatments <- prism.treat[contains_oncology, ]
oncology_treatment_ids <- rownames(oncology_treatments)
oncology_responses <- prism[, colnames(prism) %in% oncology_treatment_ids]
oncology_responses_imputed <- as.data.frame(lapply(oncology_responses, function(x) ifelse(is.na(x), mean(x, na.rm = TRUE), x)))
avg_response_oncology <- rowMeans(oncology_responses_imputed, na.rm = TRUE)

#Repeat steps 2 and 3 for non-oncology treatments
non_oncology_treatments <- prism.treat[!contains_oncology, ]
non_oncology_treatment_ids <- rownames(non_oncology_treatments)
non_oncology_responses <- prism[, colnames(prism) %in% non_oncology_treatment_ids]
non_oncology_responses_imputed <- as.data.frame(lapply(non_oncology_responses, function(x) ifelse(is.na(x), mean(x, na.rm = TRUE), x)))
avg_response_non_oncology <- rowMeans(non_oncology_responses_imputed, na.rm = TRUE)

# Calculate the fold changes
pseudo_count <- 1e-9
fold_changes_general <- (avg_response_non_oncology + pseudo_count) / (avg_response_oncology + pseudo_count)
cell_lines <- rownames(prism)  # Assuming row names represent the cell lines

# Plot the fold changes
fold_changes_df_general <- data.frame(cell_line = cell_lines, fold_change = fold_changes_general)

# Load the necessary library
library(ggplot2)

# Using ggplot2
ggplot(fold_changes_df_general, aes(x = reorder(cell_line, -fold_change), y = fold_change)) +
  geom_bar(stat = "identity", fill = "yellow") +
  theme_minimal() +
  theme(axis.text.x = element_blank()) + # This hides the x-axis labels
  labs(title = "Fold Changes Non-Oncology Treatments Relative to Oncology Treatments",
       x = "Cell Lines",
       y = "Fold Change") 



```




```{r}
library(plotly)

plot_ly(fold_changes_df_general, x = ~reorder(cell_line, -fold_change), y = ~fold_change, type = 'bar') %>%
  layout(title = "Fold Changes Non-Oncology gastric Treatments Relative to Oncology gastric Treatments",
         xaxis = list(title = "Cell Lines"),
         yaxis = list (title = "Fold Change"))
```


```{r}
# Check if the data is normally distributed
shapiro_test_oncology <- shapiro.test(avg_response_oncology)
shapiro_test_non_oncology <- shapiro.test(avg_response_non_oncology)

# Print the results
print(shapiro_test_oncology)
print(shapiro_test_non_oncology)

```

# They are normally distributed, greater than 0.05 


```{r}
t_test_result_3 <- t.test(avg_response_oncology, avg_response_non_oncology)

# Print the result
print(t_test_result_3 )

```

# P value is shorter than 0,05 -> diference is significant 


```{r}
# Perform the Mann-Whitney U Test
mann_whitney_test_result_3 <- wilcox.test(avg_response_oncology, avg_response_non_oncology)

# Print the results
print(mann_whitney_test_result_3)

```


















```{r}

# list of target molecules, replace this with actual list
target_molecules <- c("mTor", "NHP2L1", "RPL10L", "RPL11", "RPL13A", "RPL15", "RPL19", "RPL23", "AURKB", "CDK2", "CDK4", "MTOR", "PIK3CA", "BRD2", "BRD3", "BRD4", "BCL2", "EGFR", "AURKA", "AURKB", "AURKC","BRD4", "JAK1", "JAK2", "JAK3", "TYK2", "HDAC1", "HDAC2", "HDAC3", "HDAC6","HDAC1","CDK1", "CDK2", "CDK5", "CDK9", "HDAC1", "HDAC2", "HDAC3", "HDAC4", "HDAC5", "HDAC6", "HDAC7","FGFR1", "FGFR2", "FGFR3", "FGFR4", "KDR","OPRL1","HDAC1", "HDAC10", "HDAC11", "HDAC2", "HDAC3", "HDAC4", "HDAC5","FLT3", "JAK1", "JAK2", "JAK3","XPO1","EGFR", "ERBB2","BRAF","SLC6A3","ABL1","BCR", "HSP90AA1", "RELA", "CDK1", "CDK4", "CDK9", "TOP1", "TOP2A","MELK", "AURKA", "HDAC1", "HDAC2", "HDAC3", "HDAC4", "HDAC5", "HDAC6", "HDAC7", "EGFR", "ERBB2", "ERBB4", "KIF11","KIF11","XPO1","TOP2A",
"MAPK8","ARF1", "CYTH2","GSK3B", "TUBB","HSP90AA1","CHEK1", "CHEK2",
"MTOR", "PDPK1", "PDPK1","TOP1")

Filtered_data.snv <- prism.snv[prism.snv$Hugo_Symbol %in% target_molecules, ]

```

```{r}
str(prism.snv)
```
