---
title: "Hanna_BioInfo"
output: html_document
date: "2023-05-14"
---

# Hanna's random ideas

```{r}
tinytex::install_tinytex()
```

**Plotting a drug response against a gene that is overexpressed in prism.exp_gastric:**

```{r}
pheatmap(r.prism.exp_g)
#heatmap shows that there are not many values bigger than ten-> very overexpressed genes in certain cellines -> these genes i wanna extract from the dataframe into a new one
# Specify the threshold
tthreshold <- 10

# Extract columns that include values lower than the threshold
overe.genes <- r.prism.exp_g[, apply(r.prism.exp_g, 2, function(col) any(col > tthreshold))]

# Print the selected columns
print(overe.genes)
```

Reduced dataframe:

```{r}
pheatmap(overe.genes)
```

```{r}
# Calculate the mean of each column
col_Means <- colMeans(selected_drugs)

# Set a threshold for column mean
mean_threshold <- 1


# Select columns with mean greater than the threshold
selected_columns <- selected_drugs[, col_means < mean_threshold]
pheatmap(selected_columns,  cellwidth = 4, cellheight = 4,show_colnames = FALSE)
```

```{r}
dim(selected_columns)
dim(overe.genes)
print(overe.genes)
print(selected_columns)
```

Creating new dataframe of selected_columns reducing for the cell line that is more in overe.genes:

```{r}
og.v<-rownames(overe.genes)
selected_columns <- selected_columns[rownames(selected_columns) %in% og.v, ]
View (selected_columns)
```

```{r}
p<-pheatmap(r.prism.cnv_g)
```

```{r}
plot(prism_gastric$`BRD-A00077618-236-07-6::0.00061034::HTS002`, prism.cnv_gastric$DDX11L1, type = "p", pch = 16, col = "blue",
     xlab = "BRD-A00077618-236-07-6::0.00061034::HTS002", ylab = "DDX11L1", main = "Scatter Plot")
cor(prism_gastric$`BRD-A00077618-236-07-6::0.00061034::HTS002`,prism.cnv_gastric$DDX11L1, method = 'pearson')
```

```{r}
# Select the row you want to create a histogram for (e.g., row 3)
prism_g_1 <- prism_gastric_cleaned_treatments[1, ]

# Convert the row values to a numeric vector
prism_g_1 <- as.numeric(prism_g_1)

# Create a histogram of the row values
hist(prism_g_1)
```

```{r}

# Specify the threshold
threshold <- -7

# Extract columns that include values lower than the threshold
selected_drugs <- prism_gastric_cleaned_treatments[, apply(prism_gastric_cleaned_treatments, 2, function(col) any(col < threshold))]

# Print the selected columns
print(selected_drugs)
```

```{r}
class(selected_drugs)
heatmap_sd <- pheatmap(selected_drugs,cellwidth = 4, cellheight = 4, show_rownames = FALSE, show_colnames = FALSE)
```

```{r}
# Perform k-means clustering
kmeans_res <- kmeans(prism_gastric_cleaned_treatments, centers = 2)

# Extract cluster assignments
cluster_assignments <- kmeans_res$cluster

# Select the desired cluster
desired_cluster <- 2  # Adjust as needed

# Extract columns belonging to the desired cluster
clustered_columns <- prism_gastric_cleaned_treatments[, cluster_assignments == desired_cluster]

# Create a new dataframe with clustered columns
new_dataframe <- as.data.frame(clustered_columns)

```

```{r}
# Perform hierarchical clustering
hc <- hclust(dist(prism_gastric_cleaned_treatments))  # df is your dataframe

# Set the desired number of clusters
num_clusters <- 5  # Adjust as needed

# Cut the tree to obtain cluster assignments
clusters <- cutree(hc, k = num_clusters)

# Select the desired cluster
desired_cluster <- 1  # Adjust as needed

# Extract columns belonging to the desired cluster
clustered_columns <- prism_gastric_cleaned_treatments[, clusters == desired_cluster]

# Create a new dataframe with clustered columns
new_dataframe2 <- data.frame(clustered_columns)
```

```{r}
heatmap <- pheatmap(clustered_columns, cellwidth = 2, cellheight = 2,show_colnames=FALSE)
```

```{r}
# Calculate the mean of each row
col_means <- colMeans(selected_drugs)

# Print the row means
print(col_means)
hist(col_means)
```

```{r}
# Calculate the mean of each column
col_Means <- colMeans(selected_drugs)

# Set a threshold for column mean
mean_threshold <- -7

# Select columns with mean greater than the threshold
selected_columns <- selected_drugs[, col_means < mean_threshold]
pheatmap(selected_columns)
```

```{r}
boxplot(selected_columns, pch=22)
```

```{r}
selected_drugsv <- colnames(selected_drugs)

View(selected_drugsv)

prism_drugs <- prism[ ,colnames(prism) %in% selected_drugsv]
View (prism_drugs)
```

# Distribution of prism_gastric

```{r}
#Apply hist() to each column using lapply() 
lapply(prism_gastric_cleaned_treatments, hist, breaks = 20, col = "blue", main = "Distribution Diagram", xlab = "Values")
```

```{r}
# Perform t-test
t_test_result <- t.test(selected_drugs$BRD.A28970875.300.04.9..10..HTS002, selected_drugs$BRD.A54927599.001.16.9..10..HTS002)

# View the t-test result
print(t_test_result)

```

```{r}
pheatmap(r.prism.exp_g,cellwidth = 2, cellheight = 2, show_rownames = FALSE, show_colnames = FALSE)
```

```{r}
pheatmap(r.prism.exp_g,show_colnames = FALSE)
```

```{r}
density_est<- density(r.prism.achilles_g)

plot(density_est, main="Density plot of prism.achilles ")
```

```{r}
r.prism.achilles_g<- (sapply(r.prism.achilles_g, as.numeric))
is.numeric(r.prism.achilles_g)
```

General overview of the data

```{r}
prism_cleaned_drugs<- prism[,colSums(is.na(prism))==0]
prism_cleaned_drugs<- (sapply(prism, as.numeric))
is.numeric(prism_cleaned_drugs)
```

```{r}
hist(prism_cleaned_drugs)

```

**PCA von prism.exp mit allen celllines:**

```{r}
prism_genes<- prism.snv[grepl("True", prism.snv$isDeleterious),]
View(prism_genes)
#reducing the genes to just the genes that are damaging to the gastric cancer cells
r.prism.exp <- prism.exp[ ,colnames(prism.exp) %in% genes.snv_v]
```

```{r}
pheatmap(r.prism.exp)
```

Step 1: Create 5 vectors for the 5 different cancer cell lines

dataframe of breast cancer cell lines:

```{r}
breast.cancer.celllines <- subset(prism.cl, lineage == "breast")

View(breast.cancer.celllines)
```

Dataframe of gastric cancer cell lines:

```{r}
gastric.cancer.celllines <- subset(prism.cl, lineage == "gastric")

View(gastric.cancer.celllines)
```

Dataframe of kidney cancer cell lines:

```{r}
kidney.cancer.celllines <- subset(prism.cl, lineage == "kidney")

View(kidney.cancer.celllines)
```

Dataframe of liver cancer cell lines:

```{r}
liver.cancer.celllines <- subset(prism.cl, lineage == "liver")

View(liver.cancer.celllines)
```

Dataframe of bone cancer cell lines:

```{r}
bone.cancer.celllines <- subset(prism.cl, lineage == "bone")

View(bone.cancer.celllines)
```

**Extract these IDs from prism.exp**

```{r}
gastric.cancer.celllines.v <- gastric.cancer.celllines $DepMap_ID
breast.cancer.celllines.v <- breast.cancer.celllines $DepMap_ID
kidney.cancer.celllines.v <- kidney.cancer.celllines $DepMap_ID
bone.cancer.celllines.v <- bone.cancer.celllines $DepMap_ID
liver.cancer.celllines.v <- liver.cancer.celllines $DepMap_ID
cancer.celllines.v <- c(liver.cancer.celllines.v,bone.cancer.celllines.v,kidney.cancer.celllines.v,  breast.cancer.celllines.v,gastric.cancer.celllines.v)


View(gastric.cancer.celllines.v)
```

```{r}
prism.exp_celllines <- prism.exp[rownames(prism.exp) %in% cancer.celllines.v, ]
View (prism.exp_celllines)
```

Step 2 NA values:

```{r}
typeof(prism.exp_celllines)

prism.exp_celllines_numeric <- (

  sapply(prism.exp_celllines, as.numeric)

)

is.numeric(prism.exp_celllines_numeric)

prism.exp_celllines_numeric[is.na(prism.exp_celllines_numeric)] <-median(prism.exp_celllines_numeric,na.rm =TRUE)

sum(is.na(prism.exp_celllines_numeric))

View(prism.exp_celllines_numeric)

```

Remove columns with zero from the dataframe:

```{r}
# Remove columns with 0 values
prism.exp_celllines_numeric <- prism.exp_celllines_numeric[, colSums(prism.exp_celllines_numeric== 0) == 0]

# Print the filtered dataframe
print(prism.exp_celllines_numeric)
```

**PCA of this reduced data frame:**

```{r}
standardized_data.pe <- scale(prism.exp_celllines_numeric)

pca_result.pe <- prcomp(standardized_data.pe, scale. = FALSE)

View(pca_result.pe)

pcs <- pca_result.pe$x

variance_explained.pe <- pca_result.pe$sdev^2 / sum(pca_result.pe$sdev^2)

loadings.pe <- pca_result.pe$rotation

scree_plot <- plot(1:length(variance_explained.pe), variance_explained.pe, type = "b",

                    xlab = "Principal Component", ylab = "Variance Explained")


```

```{r}
# Extract the principal components
pc1 <- pca_result.pe$x[, 1] # First principal component
pc2 <- pca_result.pe$x[, 2] # Second principal component
pc_to_color <- as.numeric(pca_result.pe$x[, 3])  # Convert to numeric
# Create the scatter plot
plot(pc1, pc2, xlab = "PC1", ylab = "PC2",main = "PCA Scatter Plot", )

adjusted_color <- pc_to_color - min(pc_to_color) + 1

# Create the scatter plot with color-coded third principal component
plot(pc1, pc2, xlab = "PC1", ylab = "PC2", main = "PCA Scatter Plot",
     col = adjusted_color, pch = 16)

# Add a color legend
legend("topright", legend = "PC3", col = unique(pc_to_color), pch = 16)
```

```{r}


# Extract the principal components
pcs <- pca_result.pe$x  # All principal components

# Create the scatter plot with color-coded principal components
plot(pcs[, 1], pcs[, 2], xlab = "PC1", ylab = "PC2", main = "PCA Scatter Plot",
     col = 1:length(pcs), pch = 16)

# Create a legend with colors for each principal component
legend("topright", legend = paste0("PC", 1:ncol(pcs)),
       col = 1:length(pcs), pch = 16)
```

```{r}
# Extract the principal components
pc4 <- pca_result.pe$x[, 4] # First principal component
pc7 <- pca_result.pe$x[, 7] # Second principal component
pc_to_color <- as.numeric(pca_result.pe$x[, 3])  # Convert to numeric
# Create the scatter plot
plot(pc1, pc2, xlab = "PC4", ylab = "PC7",main = "PCA Scatter Plot", )

adjusted_color <- pc_to_color - min(pc_to_color) + 1

# Create the scatter plot with color-coded third principal component
plot(pc1, pc2, xlab = "PC4", ylab = "PC7", main = "PCA Scatter Plot",
     col = adjusted_color, pch = 16)

# Add a color legend
legend("topright", legend = "PC3", col = unique(pc_to_color), pch = 16)
```

**Calculating the variance of the rows in Prism.exp to find the genes that show the highest variance in the five cancer types and are the genes that distinguish the cancer types:**

```{r}
# Transpose the dataframe
transposed_prism.exp_celllines <- t(prism.exp_celllines)
```

```{r}

# Calculate the variance of each row

gene.exp_variances <- apply(transposed_prism.exp_celllines, MARGIN = 1, var)
gene.exp_variances2 <- apply(prism.exp_celllines, MARGIN = 1, var)
```

```{r}
#plotting the variances to define a logical treshold for selecting drugs
hist(gene.exp_variances)
hist(gene.exp_variances2)
```

```{r}
threshold <- 3
selected_genes_var <- transposed_prism.exp_celllines[gene.exp_variances > threshold, ]
threshold2 <- 6.5
selected_genes_var2 <- prism.exp_celllines[gene.exp_variances2 > threshold2, ]
```

```{r}
print(selected_genes_var)
```

```{r}
prism.exp.var<-t(selected_genes_var)
```

PCA von Prism.exp:

```{r}

pca_result_prism.exp.var <- prcomp(prism.exp.var)
pca_values <- pca_result_prism.exp.var$x # Principal component scores (transformed data)
pca_variances <- pca_result_prism.exp.var$sdev^2  # Variance explained by each principal component
pca_proportions <- pca_variances / sum(pca_variances)  # Proportion of variance explained by each principal component
pca_loadings <- pca_result_prism.exp.var$rotation  # Loadings (coefficients) of each variable on each principal component
 plot(1:length(pca_variances), pca_variances, type = "b", xlab = "Principal Component", ylab = "Variance Explained",
     main = "Scree Plot")
plot(pca_values[, 1], pca_values[, 2], xlab = "PC1", ylab = "PC2")


###
pca_data <- data.frame(PC1 = pca_values[, 1], PC2 = pca_values[, 2],CellLine = rownames(pca_values) )

bone.cancer.celllines.group<- "red"
kidney.cancer.celllines.group <- "blue"
liver.cancer.celllines.group <- "green"
gastric.cancer.celllines.group<- "purple"
breast.cancer.celllines.group <- "orange"

pca_data$Group <- NA
pca_data$Group[pca_data$CellLine %in% bone.cancer.celllines.v] <- "Bone cancer"
pca_data$Group[pca_data$CellLine %in% kidney.cancer.celllines.v] <- "Kidney cancer"
pca_data$Group[pca_data$CellLine %in% liver.cancer.celllines.v] <- "Liver cancer"
pca_data$Group[pca_data$CellLine %in% gastric.cancer.celllines.v] <- "Gastric cancer"
pca_data$Group[pca_data$CellLine %in% breast.cancer.celllines.v]<-"Breast cancer"

ggplot(pca_data, aes(x = PC1, y = PC2, color = Group)) +
  geom_point() +
  scale_color_manual(values = c("Bone cancer"=bone.cancer.celllines.group, "Kidney cancer"=kidney.cancer.celllines.group, "Liver cancer"=liver.cancer.celllines.group, "Gastric cancer"=gastric.cancer.celllines.group,"Breast cancer"= breast.cancer.celllines.group)) +
  labs(x = "PC1", y = "PC2", title = "PCA Scatter Plot")

```

```{r}
pca_result_genes_var <- prcomp(selected_genes_var)
pca_values <- pca_result_genes_var$x # Principal component scores (transformed data)
pca_variances <- pca_result_genes_var$sdev^2  # Variance explained by each principal component
pca_proportions <- pca_variances / sum(pca_variances)  # Proportion of variance explained by each principal component
pca_loadings <- pca_result_genes_var$rotation  # Loadings (coefficients) of each variable on each principal component
 plot(1:length(pca_variances), pca_variances, type = "b", xlab = "Principal Component", ylab = "Variance Explained",
     main = "Scree Plot")
plot(pca_values[, 1], pca_values[, 2], xlab = "PC1", ylab = "PC2")


###
pca_data <- data.frame(PC1 = pca_values[, 1], PC2 = pca_values[, 2],CellLine = rownames(pca_values) )

bone.cancer.celllines.group<- "red"
kidney.cancer.celllines.group <- "blue"
liver.cancer.celllines.group <- "green"
gastric.cancer.celllines.group<- "purple"
breast.cancer.celllines.group <- "orange"

pca_data$Group <- NA
pca_data$Group[pca_data$CellLine %in% bone.cancer.celllines.v] <- "Bone cancer"
pca_data$Group[pca_data$CellLine %in% kidney.cancer.celllines.v] <- "Kidney cancer"
pca_data$Group[pca_data$CellLine %in% liver.cancer.celllines.v] <- "Liver cancer"
pca_data$Group[pca_data$CellLine %in% gastric.cancer.celllines.v] <- "Gastric cancer"
pca_data$Group[pca_data$CellLine %in% breast.cancer.celllines.v]<-"Breast cancer"

ggplot(pca_data, aes(x = PC1, y = PC2, color = Group)) +
  geom_point() +
  scale_color_manual(values = c(bone.cancer.celllines.group, kidney.cancer.celllines.group, liver.cancer.celllines.group, gastric.cancer.celllines.group, breast.cancer.celllines.group)) +
  labs(x = "PC1", y = "PC2", title = "PCA Scatter Plot")
```

```{r}
pca_result_genes_var2 <- prcomp(selected_genes_var2)
pca_values <- pca_result_genes_var2$x # Principal component scores (transformed data)
pca_variances <- pca_result_genes_var2$sdev^2  # Variance explained by each principal component
pca_proportions <- pca_variances / sum(pca_variances)  # Proportion of variance explained by each principal component
pca_loadings <- pca_result_genes_var2$rotation  # Loadings (coefficients) of each variable on each principal component
 plot(1:length(pca_variances), pca_variances, type = "b", xlab = "Principal Component", ylab = "Variance Explained",
     main = "Scree Plot")
plot(pca_values[, 1], pca_values[, 2], xlab = "PC1", ylab = "PC2")


###
pca_data <- data.frame(PC1 = pca_values[, 1], PC2 = pca_values[, 2],CellLine = rownames(pca_values) )

bone.cancer.celllines.group<- "red"
kidney.cancer.celllines.group <- "blue"
liver.cancer.celllines.group <- "green"
gastric.cancer.celllines.group<- "purple"
breast.cancer.celllines.group <- "orange"

pca_data$Group <- NA
pca_data$Group[pca_data$CellLine %in% bone.cancer.celllines.v] <- "Bone cancer"
pca_data$Group[pca_data$CellLine %in% kidney.cancer.celllines.v] <- "Kidney cancer"
pca_data$Group[pca_data$CellLine %in% liver.cancer.celllines.v] <- "Liver cancer"
pca_data$Group[pca_data$CellLine %in% gastric.cancer.celllines.v] <- "Gastric cancer"
pca_data$Group[pca_data$CellLine %in% breast.cancer.celllines.v]<-"Breast cancer"

ggplot(pca_data, aes(x = PC1, y = PC2, color = Group)) +
  geom_point() +
  scale_color_manual(values = c(bone.cancer.celllines.group, kidney.cancer.celllines.group, liver.cancer.celllines.group, gastric.cancer.celllines.group, breast.cancer.celllines.group)) +
  labs(x = "PC1", y = "PC2", title = "PCA Scatter Plot")
```

**Create new dataframes of prism based of the treatments original indication:**

Creating dataframe of prism with treatment of oncology and with treat not of oncology

```{r}
condition1 <- prism.treat$disease.area ==  'oncology'
condition2 <- prism.treat$disease.area !=  'oncology'
```

```{r}
selected_treat_onc<- rownames(prism.treat)[condition1]
selected_treat_nonc<- rownames(prism.treat)[condition2]
selected_treat_onc <- na.omit(selected_treat_onc)
selected_treat_nonc<- na.omit(selected_treat_nonc)
```

```{r}
prism_onc <- prism_celllines[, selected_treat_onc,drop = FALSE] 
prism_nonc <- prism_celllines[, selected_treat_nonc,drop = FALSE]
```

```{r}
# Replace NA values with zero in the entire dataframe
prism_onc[is.na(prism_onc)] <- 0
# Replace NA values with zero in the entire dataframe
prism_nonc[is.na(prism_nonc)] <- 0
pheatmap(prism_onc,show_colnames = FALSE)
```

```{r}
pheatmap(prism_nonc,ColCol = NA,show_colnames = FALSE)
```

**Trying to extract treatments froms prism.treat that have already an indication related to gastric affected diseases:**

```{r}
gastric_treat <- subset(prism.treat, grepl("gastroenterology", disease.area))
selected_gastric_treat<- rownames(gastric_treat)

selected_gastric_treat<- na.omit(selected_gastric_treat)
prism_gastrictreat <- prism_celllines[, selected_gastric_treat,drop = FALSE]
```

```{r}
# Replace NA values with zero in the entire dataframe
prism_gastrictreat[is.na(prism_gastrictreat)] <- 0

pheatmap(prism_gastrictreat, show_colnames = FALSE)
```

**Reducing the dataframe prism.exp to just the genes that show high variance within a cancertype to see if the clustering based on PCA differs :**

First Step:

Create dataframes with just the cellines from one of the five cancer types:

```{r}
#Gastric cancer Dataframe of Prism.exp
G.prism.exp<-prism.exp_celllines[rownames(prism.exp_celllines) %in% gastric.cancer.celllines.v, ]
#Kidney cancer Dataframe of Prism.exp
K.prism.exp<-prism.exp_celllines[rownames(prism.exp_celllines) %in% kidney.cancer.celllines.v, ]
#Bone cancer Dataframe of Prism.exp
B.prism.exp<-prism.exp_celllines[rownames(prism.exp_celllines) %in% bone.cancer.celllines.v, ]
#Breast cancer Dataframe of Prism.exp
Br.prism.exp<-prism.exp_celllines[rownames(prism.exp_celllines) %in% breast.cancer.celllines.v, ]
#Liver cancer Dataframe of Prism.exp
L.prism.exp<-prism.exp_celllines[rownames(prism.exp_celllines) %in% liver.cancer.celllines.v, ]
```

```{r}
# Name der gewünschten Spalte
spaltenname <- "CDH1"

# Durchschnitt (Mittelwert) der Spalte berechnen
durchschnitt <- mean(Br.prism.exp[[spaltenname]])

# Ausgabe des Durchschnitts
print(durchschnitt)

# Durchschnitt (Mittelwert) der Spalte berechnen
durchschnitt1 <- mean(G.prism.exp[[spaltenname]])

# Ausgabe des Durchschnitts
print(durchschnitt1)
```

Second step:

Transpose those dataframes to calculate the variance of each row so from the gene expression of one gene :

```{r}
# Transpose the dataframes
t.G.prism.exp <- t(G.prism.exp)
t.K.prism.exp<- t(K.prism.exp)
t.B.prism.exp<- t(B.prism.exp)
t.Br.prism.exp<-t(Br.prism.exp)
t.L.prism.exp<-t(L.prism.exp)
```

```{r}
# Calculate the variance of each row of the dataframes cancertypes

G.gene.exp_variances <- apply(t.G.prism.exp, MARGIN = 1, var)
K.gene.exp_variances <- apply(t.K.prism.exp, MARGIN = 1, var)
B.gene.exp_variances <- apply(t.B.prism.exp, MARGIN = 1, var)
Br.gene.exp_variances <- apply(t.Br.prism.exp, MARGIN = 1, var)
L.gene.exp_variances <- apply(t.L.prism.exp, MARGIN = 1, var)
```

```{r}
#plotting the variances to define a logical treshold for selecting drugs
hist(G.gene.exp_variances)
hist(K.gene.exp_variances)
hist(L.gene.exp_variances)
hist(B.gene.exp_variances)
hist(Br.gene.exp_variances)
```

Tresholds:

Gatsric Cancer: 3

Kidney Cancer: 3

Liver Cancer: 4

Bone Cancer : 3

Breast Cancer 3

```{r}
threshold <- 7
G.selected_genes_var <- t.G.prism.exp[G.gene.exp_variances > threshold, ]
threshold <- 7
K.selected_genes_var <- t.K.prism.exp[K.gene.exp_variances > threshold, ]
threshold2 <- 8
L.selected_genes_var <- t.L.prism.exp[L.gene.exp_variances > threshold2, ]
threshold <- 7
B.selected_genes_var <- t.B.prism.exp[B.gene.exp_variances > threshold, ]
threshold <- 7
Br.selected_genes_var <- t.Br.prism.exp[Br.gene.exp_variances > threshold, ]
```

```{r}
G.prism.exp.var<-t(G.selected_genes_var)
K.prism.exp.var<-t(K.selected_genes_var)
L.prism.exp.var<-t(L.selected_genes_var)
B.prism.exp.var<-t(B.selected_genes_var)
Br.prism.exp.var<-t(Br.selected_genes_var)
```

Step 3: Creating a new dataframe of prism.exp with all genes that are left in the dataframes reduced to the genes showing high variance within a cancer type:

```{r}
G.column_names <- colnames(G.prism.exp.var)
K.column_names <- colnames(K.prism.exp.var)
L.column_names <- colnames(L.prism.exp.var)
B.column_names <- colnames(B.prism.exp.var)
Br.column_names <- colnames(Br.prism.exp.var)

```

```{r}
genes_variance.V <- c(G.column_names,K.column_names,L.column_names,B.column_names,Br.column_names)
```

```{r}
prism.exp_geneshv <- prism.exp_celllines[,colnames( prism.exp_celllines) %in% genes_variance.V ]

```

Step 4: Creating PCA

```{r}
pca_result_prism.exp_geneshv <- prcomp(prism.exp_geneshv)
pca_values <- pca_result_prism.exp_geneshv $x # Principal component scores (transformed data)
pca_variances <- pca_result_prism.exp_geneshv $sdev^2  # Variance explained by each principal component
pca_proportions <- pca_variances / sum(pca_variances)  # Proportion of variance explained by each principal component
pca_loadings <- pca_result_prism.exp_geneshv $rotation  # Loadings (coefficients) of each variable on each principal component
 plot(1:length(pca_variances), pca_variances, type = "b", xlab = "Principal Component", ylab = "Variance Explained",
     main = "Scree Plot")
plot(pca_values[, 1], pca_values[, 2], xlab = "PC1", ylab = "PC2")


###
pca_data <- data.frame(PC1 = pca_values[, 1], PC2 = pca_values[, 2],CellLine = rownames(pca_values) )

bone.cancer.celllines.group<- "red"
kidney.cancer.celllines.group <- "blue"
liver.cancer.celllines.group <- "green"
gastric.cancer.celllines.group<- "purple"
breast.cancer.celllines.group <- "orange"

pca_data$Group <- NA
pca_data$Group[pca_data$CellLine %in% bone.cancer.celllines.v] <- "Bone cancer"
pca_data$Group[pca_data$CellLine %in% kidney.cancer.celllines.v] <- "Kidney cancer"
pca_data$Group[pca_data$CellLine %in% liver.cancer.celllines.v] <- "Liver cancer"
pca_data$Group[pca_data$CellLine %in% gastric.cancer.celllines.v] <- "Gastric cancer"
pca_data$Group[pca_data$CellLine %in% breast.cancer.celllines.v]<-"Breast cancer"

ggplot(pca_data, aes(x = PC1, y = PC2, color = Group)) +
  geom_point() +
  scale_color_manual(values = c("Bone cancer"=bone.cancer.celllines.group, "Kidney cancer"=kidney.cancer.celllines.group, "Liver cancer"=liver.cancer.celllines.group, "Gastric cancer"=gastric.cancer.celllines.group,"Breast cancer"= breast.cancer.celllines.group)) +
  labs(x = "PC1", y = "PC2", title = "PCA Scatter Plot")
```

Redoing the plot above with circles in the scatterplot :

```{r}
install.packages("ggalt")

library(ggplot2)
library(ggalt)

pca_result_prism.exp_geneshv <- prcomp(prism.exp_geneshv)
pca_values <- pca_result_prism.exp_geneshv $x # Principal component scores (transformed data)
pca_variances <- pca_result_prism.exp_geneshv $sdev^2  # Variance explained by each principal component
pca_proportions <- pca_variances / sum(pca_variances)  # Proportion of variance explained by each principal component
pca_loadings <- pca_result_prism.exp_geneshv $rotation  # Loadings (coefficients) of each variable on each principal component
 plot(1:length(pca_variances), pca_variances, type = "b", xlab = "Principal Component", ylab = "Variance Explained",
     main = "Scree Plot")
plot(pca_values[, 1], pca_values[, 2], xlab = "PC1", ylab = "PC2")


###
pca_data <- data.frame(PC1 = pca_values[, 1], PC2 = pca_values[, 2],CellLine = rownames(pca_values) )

bone.cancer.celllines.group<- "red"
kidney.cancer.celllines.group <- "blue"
liver.cancer.celllines.group <- "green"
gastric.cancer.celllines.group<- "purple"
breast.cancer.celllines.group <- "orange"

pca_data$Group <- NA
pca_data$Group[pca_data$CellLine %in% bone.cancer.celllines.v] <- "Bone cancer"
pca_data$Group[pca_data$CellLine %in% kidney.cancer.celllines.v] <- "Kidney cancer"
pca_data$Group[pca_data$CellLine %in% liver.cancer.celllines.v] <- "Liver cancer"
pca_data$Group[pca_data$CellLine %in% gastric.cancer.celllines.v] <- "Gastric cancer"
pca_data$Group[pca_data$CellLine %in% breast.cancer.celllines.v]<-"Breast cancer"

ggplot(pca_data, aes(x = PC1, y = PC2, color = Group)) +
  geom_point() +
  geom_encircle(aes(x = PC1, y = PC2), color = "black", expand = 0.05) +
  scale_color_manual(values = c("Bone cancer" = bone.cancer.celllines.group, "Kidney cancer" = kidney.cancer.celllines.group, "Liver cancer" = liver.cancer.celllines.group, "Gastric cancer" = gastric.cancer.celllines.group, "Breast cancer" = breast.cancer.celllines.group)) +
  labs(x = "PC1", y = "PC2", title = "PCA Scatter Plot")
```

```{r}
ggplot(pca_data, aes(x = PC1, y = PC2, color = Group)) +
  geom_point() +
  stat_ellipse(geom = "path", aes(group = Group), color = "black", alpha = 0.2) +
  scale_color_manual(values = c("Bone cancer" = bone.cancer.celllines.group, "Kidney cancer" = kidney.cancer.celllines.group, "Liver cancer" = liver.cancer.celllines.group, "Gastric cancer" = gastric.cancer.celllines.group, "Breast cancer" = breast.cancer.celllines.group)) +
  labs(x = "PC1", y = "PC2", title = "PCA Scatter Plot")
```

```{r}
ggplot(pca_data, aes(x = PC1, y = PC2, color = Group)) +
  geom_point() +
  stat_ellipse(geom = "path", aes(group = Group, color = Group), alpha = 0.2) +
  scale_color_manual(values = c("Bone cancer" = "red", "Kidney cancer" = "blue", "Liver cancer" = "green", "Gastric cancer" = "purple", "Breast cancer" = "orange")) +
  labs(x = "PC1", y = "PC2", title = "PCA Scatter Plot")
```

**Applying PCA on the oncological and non-oncological dataframes:**

```{r}
transposed_prism_onc<- t(prism_onc)
transposed_prism_nonc<- t(prism_nonc)
transposed_prism_gastrictreat<- t(prism_gastrictreat)

#Variance in treatment response
prism.onc_var<-apply(transposed_prism_onc, MARGIN = 1, var)
prism.nonc_var<-apply(transposed_prism_nonc, MARGIN = 1, var)
prism.gastrictreat_var<-apply(transposed_prism_gastrictreat, MARGIN = 1, var)

hist(prism.onc_var)
hist(prism.nonc_var)
hist(prism.gastrictreat_var)
```

```{r}
treshold.onc<- 3
treshhold.nonc<-3
treshhold.gc<-2.5

selected_treatonc_var<- transposed_prism_onc[prism.onc_var>treshold.onc,]
selected_treatnonc_var<- transposed_prism_nonc[prism.nonc_var>treshhold.nonc,]
selected_treatgc_var<- transposed_prism_gastrictreat[prism.gastrictreat_var>treshhold.gc,]

prism.onc.var<- t(selected_treatonc_var)
prism.nonc.var<- t(selected_treatnonc_var)
prism.gc.var<- t(selected_treatgc_var)
```

```{r}
pca_result_prism_onc <- prcomp(prism.onc.var)
pca_values <- pca_result_prism_onc$x # Principal component scores (transformed data)
pca_variances <- pca_result_prism_onc$sdev^2  # Variance explained by each principal component
pca_proportions <- pca_variances / sum(pca_variances)  # Proportion of variance explained by each principal component
pca_loadings <-  pca_result_prism_onc$rotation  # Loadings (coefficients) of each variable on each principal component
 plot(1:length(pca_variances), pca_variances, type = "b", xlab = "Principal Component", ylab = "Variance Explained",
     main = "Scree Plot")
plot(pca_values[, 1], pca_values[, 2], xlab = "PC1", ylab = "PC2")


###
pca_data <- data.frame(PC1 = pca_values[, 1], PC2 = pca_values[, 2],CellLine = rownames(pca_values) )

bone.cancer.celllines.group<- "red"
kidney.cancer.celllines.group <- "blue"
liver.cancer.celllines.group <- "green"
gastric.cancer.celllines.group<- "purple"
breast.cancer.celllines.group <- "orange"

pca_data$Group <- NA
pca_data$Group[pca_data$CellLine %in% bone.cancer.celllines.v] <- "Bone cancer"
pca_data$Group[pca_data$CellLine %in% kidney.cancer.celllines.v] <- "Kidney cancer"
pca_data$Group[pca_data$CellLine %in% liver.cancer.celllines.v] <- "Liver cancer"
pca_data$Group[pca_data$CellLine %in% gastric.cancer.celllines.v] <- "Gastric cancer"
pca_data$Group[pca_data$CellLine %in% breast.cancer.celllines.v]<-"Breast cancer"

ggplot(pca_data, aes(x = PC1, y = PC2, color = Group)) +
  geom_point() +
  scale_color_manual(values = c("Bone cancer"=bone.cancer.celllines.group, "Kidney cancer"=kidney.cancer.celllines.group, "Liver cancer"=liver.cancer.celllines.group, "Gastric cancer"=gastric.cancer.celllines.group,"Breast cancer"= breast.cancer.celllines.group)) +
  labs(x = "PC1", y = "PC2", title = "PCA Scatter Plot")

```

```{r}
pca_result_prism_onc <- prcomp(prism_onc)
pca_values <- pca_result_prism_onc$x # Principal component scores (transformed data)
pca_variances <- pca_result_prism_onc$sdev^2  # Variance explained by each principal component
pca_proportions <- pca_variances / sum(pca_variances)  # Proportion of variance explained by each principal component
pca_loadings <-  pca_result_prism_onc$rotation  # Loadings (coefficients) of each variable on each principal component
 plot(1:length(pca_variances), pca_variances, type = "b", xlab = "Principal Component", ylab = "Variance Explained",
     main = "Scree Plot")
plot(pca_values[, 1], pca_values[, 2], xlab = "PC1", ylab = "PC2")


###
pca_data <- data.frame(PC1 = pca_values[, 1], PC2 = pca_values[, 2],CellLine = rownames(pca_values) )

bone.cancer.celllines.group<- "red"
kidney.cancer.celllines.group <- "blue"
liver.cancer.celllines.group <- "green"
gastric.cancer.celllines.group<- "purple"
breast.cancer.celllines.group <- "orange"

pca_data$Group <- NA
pca_data$Group[pca_data$CellLine %in% bone.cancer.celllines.v] <- "Bone cancer"
pca_data$Group[pca_data$CellLine %in% kidney.cancer.celllines.v] <- "Kidney cancer"
pca_data$Group[pca_data$CellLine %in% liver.cancer.celllines.v] <- "Liver cancer"
pca_data$Group[pca_data$CellLine %in% gastric.cancer.celllines.v] <- "Gastric cancer"
pca_data$Group[pca_data$CellLine %in% breast.cancer.celllines.v]<-"Breast cancer"

ggplot(pca_data, aes(x = PC1, y = PC2, color = Group)) +
  geom_point() +
  scale_color_manual(values = c("Bone cancer"=bone.cancer.celllines.group, "Kidney cancer"=kidney.cancer.celllines.group, "Liver cancer"=liver.cancer.celllines.group, "Gastric cancer"=gastric.cancer.celllines.group,"Breast cancer"= breast.cancer.celllines.group)) +
  labs(x = "PC1", y = "PC2", title = "PCA Scatter Plot")
```

```{r}
pca_result_prism_nonc <- prcomp(prism_nonc)
pca_values <- pca_result_prism_nonc$x # Principal component scores (transformed data)
pca_variances <- pca_result_prism_nonc$sdev^2  # Variance explained by each principal component
pca_proportions <- pca_variances / sum(pca_variances)  # Proportion of variance explained by each principal component
pca_loadings <-  pca_result_prism_nonc$rotation  # Loadings (coefficients) of each variable on each principal component
 plot(1:length(pca_variances), pca_variances, type = "b", xlab = "Principal Component", ylab = "Variance Explained",
     main = "Scree Plot")
plot(pca_values[, 1], pca_values[, 2], xlab = "PC1", ylab = "PC2")


###
pca_data <- data.frame(PC1 = pca_values[, 1], PC2 = pca_values[, 2],CellLine = rownames(pca_values) )

bone.cancer.celllines.group<- "red"
kidney.cancer.celllines.group <- "blue"
liver.cancer.celllines.group <- "green"
gastric.cancer.celllines.group<- "purple"
breast.cancer.celllines.group <- "orange"

pca_data$Group <- NA
pca_data$Group[pca_data$CellLine %in% bone.cancer.celllines.v] <- "Bone cancer"
pca_data$Group[pca_data$CellLine %in% kidney.cancer.celllines.v] <- "Kidney cancer"
pca_data$Group[pca_data$CellLine %in% liver.cancer.celllines.v] <- "Liver cancer"
pca_data$Group[pca_data$CellLine %in% gastric.cancer.celllines.v] <- "Gastric cancer"
pca_data$Group[pca_data$CellLine %in% breast.cancer.celllines.v]<-"Breast cancer"

ggplot(pca_data, aes(x = PC1, y = PC2, color = Group)) +
  geom_point() +
  scale_color_manual(values = c("Bone cancer"=bone.cancer.celllines.group, "Kidney cancer"=kidney.cancer.celllines.group, "Liver cancer"=liver.cancer.celllines.group, "Gastric cancer"=gastric.cancer.celllines.group,"Breast cancer"= breast.cancer.celllines.group)) +
  labs(x = "PC1", y = "PC2", title = "PCA Scatter Plot")
```

```{r}
pca_result_prism_nonc <- prcomp(prism.nonc.var)
pca_values <- pca_result_prism_nonc$x # Principal component scores (transformed data)
pca_variances <- pca_result_prism_nonc$sdev^2  # Variance explained by each principal component
pca_proportions <- pca_variances / sum(pca_variances)  # Proportion of variance explained by each principal component
pca_loadings <-  pca_result_prism_nonc$rotation  # Loadings (coefficients) of each variable on each principal component
 plot(1:length(pca_variances), pca_variances, type = "b", xlab = "Principal Component", ylab = "Variance Explained",
     main = "Scree Plot")
plot(pca_values[, 1], pca_values[, 2], xlab = "PC1", ylab = "PC2")


###
pca_data <- data.frame(PC1 = pca_values[, 1], PC2 = pca_values[, 2],CellLine = rownames(pca_values) )

bone.cancer.celllines.group<- "red"
kidney.cancer.celllines.group <- "blue"
liver.cancer.celllines.group <- "green"
gastric.cancer.celllines.group<- "purple"
breast.cancer.celllines.group <- "orange"

pca_data$Group <- NA
pca_data$Group[pca_data$CellLine %in% bone.cancer.celllines.v] <- "Bone cancer"
pca_data$Group[pca_data$CellLine %in% kidney.cancer.celllines.v] <- "Kidney cancer"
pca_data$Group[pca_data$CellLine %in% liver.cancer.celllines.v] <- "Liver cancer"
pca_data$Group[pca_data$CellLine %in% gastric.cancer.celllines.v] <- "Gastric cancer"
pca_data$Group[pca_data$CellLine %in% breast.cancer.celllines.v]<-"Breast cancer"

ggplot(pca_data, aes(x = PC1, y = PC2, color = Group)) +
  geom_point() +
  scale_color_manual(values = c("Bone cancer"=bone.cancer.celllines.group, "Kidney cancer"=kidney.cancer.celllines.group, "Liver cancer"=liver.cancer.celllines.group, "Gastric cancer"=gastric.cancer.celllines.group,"Breast cancer"= breast.cancer.celllines.group)) +
  labs(x = "PC1", y = "PC2", title = "PCA Scatter Plot")
```

```{r}
prism_gastrictreat
pca_result_prism_gastrictreat <- prcomp(prism_gastrictreat)
pca_values <- pca_result_prism_gastrictreat$x # Principal component scores (transformed data)
pca_variances <- pca_result_prism_gastrictreat$sdev^2  # Variance explained by each principal component
pca_proportions <- pca_variances / sum(pca_variances)  # Proportion of variance explained by each principal component
pca_loadings <-  pca_result_prism_gastrictreat$rotation  # Loadings (coefficients) of each variable on each principal component
 plot(1:length(pca_variances), pca_variances, type = "b", xlab = "Principal Component", ylab = "Variance Explained",
     main = "Scree Plot")
plot(pca_values[, 1], pca_values[, 2], xlab = "PC1", ylab = "PC2")


###
pca_data <- data.frame(PC1 = pca_values[, 1], PC2 = pca_values[, 2],CellLine = rownames(pca_values) )

bone.cancer.celllines.group<- "red"
kidney.cancer.celllines.group <- "blue"
liver.cancer.celllines.group <- "green"
gastric.cancer.celllines.group<- "purple"
breast.cancer.celllines.group <- "orange"

pca_data$Group <- NA
pca_data$Group[pca_data$CellLine %in% bone.cancer.celllines.v] <- "Bone cancer"
pca_data$Group[pca_data$CellLine %in% kidney.cancer.celllines.v] <- "Kidney cancer"
pca_data$Group[pca_data$CellLine %in% liver.cancer.celllines.v] <- "Liver cancer"
pca_data$Group[pca_data$CellLine %in% gastric.cancer.celllines.v] <- "Gastric cancer"
pca_data$Group[pca_data$CellLine %in% breast.cancer.celllines.v]<-"Breast cancer"

ggplot(pca_data, aes(x = PC1, y = PC2, color = Group)) +
  geom_point() +
  scale_color_manual(values = c("Bone cancer"=bone.cancer.celllines.group, "Kidney cancer"=kidney.cancer.celllines.group, "Liver cancer"=liver.cancer.celllines.group, "Gastric cancer"=gastric.cancer.celllines.group,"Breast cancer"= breast.cancer.celllines.group)) +
  labs(x = "PC1", y = "PC2", title = "PCA Scatter Plot")
```

```{r}
pca_result_prism_nonc <- prcomp(prism.gc.var)
pca_values <- pca_result_prism_nonc$x # Principal component scores (transformed data)
pca_variances <- pca_result_prism_nonc$sdev^2  # Variance explained by each principal component
pca_proportions <- pca_variances / sum(pca_variances)  # Proportion of variance explained by each principal component
pca_loadings <-  pca_result_prism_nonc$rotation  # Loadings (coefficients) of each variable on each principal component
 plot(1:length(pca_variances), pca_variances, type = "b", xlab = "Principal Component", ylab = "Variance Explained",
     main = "Scree Plot")
plot(pca_values[, 1], pca_values[, 2], xlab = "PC1", ylab = "PC2")


###
pca_data <- data.frame(PC1 = pca_values[, 1], PC2 = pca_values[, 2],CellLine = rownames(pca_values) )

bone.cancer.celllines.group<- "red"
kidney.cancer.celllines.group <- "blue"
liver.cancer.celllines.group <- "green"
gastric.cancer.celllines.group<- "purple"
breast.cancer.celllines.group <- "orange"

pca_data$Group <- NA
pca_data$Group[pca_data$CellLine %in% bone.cancer.celllines.v] <- "Bone cancer"
pca_data$Group[pca_data$CellLine %in% kidney.cancer.celllines.v] <- "Kidney cancer"
pca_data$Group[pca_data$CellLine %in% liver.cancer.celllines.v] <- "Liver cancer"
pca_data$Group[pca_data$CellLine %in% gastric.cancer.celllines.v] <- "Gastric cancer"
pca_data$Group[pca_data$CellLine %in% breast.cancer.celllines.v]<-"Breast cancer"

ggplot(pca_data, aes(x = PC1, y = PC2, color = Group)) +
  geom_point() +
  scale_color_manual(values = c("Bone cancer"=bone.cancer.celllines.group, "Kidney cancer"=kidney.cancer.celllines.group, "Liver cancer"=liver.cancer.celllines.group, "Gastric cancer"=gastric.cancer.celllines.group,"Breast cancer"= breast.cancer.celllines.group)) +
  labs(x = "PC1", y = "PC2", title = "PCA Scatter Plot")
```

Transposing the dataframes to do pca with treatments as dots:

```{r}
t.prism_onc<-t(prism_onc)
t.prism_nonc<-t(prism_nonc)
t.prism_gastrictreat<-t(prism_gastrictreat)
```

```{r}
prism_gastrictreat
pca_result_t.prism_onc <- prcomp(t.prism_onc)
pca_values <- pca_result_t.prism_onc$x # Principal component scores (transformed data)
pca_variances <- pca_result_t.prism_onc$sdev^2  # Variance explained by each principal component
pca_proportions <- pca_variances / sum(pca_variances)  # Proportion of variance explained by each principal component
pca_loadings <-  pca_result_t.prism_onc$rotation  # Loadings (coefficients) of each variable on each principal component
 plot(1:length(pca_variances), pca_variances, type = "b", xlab = "Principal Component", ylab = "Variance Explained",
     main = "Scree Plot")
plot(pca_values[, 1], pca_values[, 2], xlab = "PC1", ylab = "PC2")


###
pca_data <- data.frame(PC1 = pca_values[, 1], PC2 = pca_values[, 2],CellLine = rownames(pca_values) )

bone.cancer.celllines.group<- "red"
kidney.cancer.celllines.group <- "blue"
liver.cancer.celllines.group <- "green"
gastric.cancer.celllines.group<- "purple"
breast.cancer.celllines.group <- "orange"

pca_data$Group <- NA
pca_data$Group[pca_data$CellLine %in% bone.cancer.celllines.v] <- "Bone cancer"
pca_data$Group[pca_data$CellLine %in% kidney.cancer.celllines.v] <- "Kidney cancer"
pca_data$Group[pca_data$CellLine %in% liver.cancer.celllines.v] <- "Liver cancer"
pca_data$Group[pca_data$CellLine %in% gastric.cancer.celllines.v] <- "Gastric cancer"
pca_data$Group[pca_data$CellLine %in% breast.cancer.celllines.v]<-"Breast cancer"

ggplot(pca_data, aes(x = PC1, y = PC2, color = Group)) +
  geom_point() +
  scale_color_manual(values = c("Bone cancer"=bone.cancer.celllines.group, "Kidney cancer"=kidney.cancer.celllines.group, "Liver cancer"=liver.cancer.celllines.group, "Gastric cancer"=gastric.cancer.celllines.group,"Breast cancer"= breast.cancer.celllines.group)) +
  labs(x = "PC1", y = "PC2", title = "PCA Scatter Plot")
```

```{r}
prism_gastrictreat
pca_result_t.prism_nonc <- prcomp(t.prism_nonc)
pca_values <- pca_result_t.prism_nonc$x # Principal component scores (transformed data)
pca_variances <-pca_result_t.prism_nonc$sdev^2  # Variance explained by each principal component
pca_proportions <- pca_variances / sum(pca_variances)  # Proportion of variance explained by each principal component
pca_loadings <-  pca_result_t.prism_nonc$rotation  # Loadings (coefficients) of each variable on each principal component
 plot(1:length(pca_variances), pca_variances, type = "b", xlab = "Principal Component", ylab = "Variance Explained",
     main = "Scree Plot")
plot(pca_values[, 1], pca_values[, 2], xlab = "PC1", ylab = "PC2")


###
pca_data <- data.frame(PC1 = pca_values[, 1], PC2 = pca_values[, 2],CellLine = rownames(pca_values) )

bone.cancer.celllines.group<- "red"
kidney.cancer.celllines.group <- "blue"
liver.cancer.celllines.group <- "green"
gastric.cancer.celllines.group<- "purple"
breast.cancer.celllines.group <- "orange"

pca_data$Group <- NA
pca_data$Group[pca_data$CellLine %in% bone.cancer.celllines.v] <- "Bone cancer"
pca_data$Group[pca_data$CellLine %in% kidney.cancer.celllines.v] <- "Kidney cancer"
pca_data$Group[pca_data$CellLine %in% liver.cancer.celllines.v] <- "Liver cancer"
pca_data$Group[pca_data$CellLine %in% gastric.cancer.celllines.v] <- "Gastric cancer"
pca_data$Group[pca_data$CellLine %in% breast.cancer.celllines.v]<-"Breast cancer"

ggplot(pca_data, aes(x = PC1, y = PC2, color = Group)) +
  geom_point() +
  scale_color_manual(values = c("Bone cancer"=bone.cancer.celllines.group, "Kidney cancer"=kidney.cancer.celllines.group, "Liver cancer"=liver.cancer.celllines.group, "Gastric cancer"=gastric.cancer.celllines.group,"Breast cancer"= breast.cancer.celllines.group)) +
  labs(x = "PC1", y = "PC2", title = "PCA Scatter Plot")
```

```{r}
prism_gastrictreat
pca_result_t.prism_gastrictreat <- prcomp(t.prism_gastrictreat)
pca_values <- pca_result_t.prism_gastrictreat$x # Principal component scores (transformed data)
pca_variances <- pca_result_t.prism_gastrictreat$sdev^2  # Variance explained by each principal component
pca_proportions <- pca_variances / sum(pca_variances)  # Proportion of variance explained by each principal component
pca_loadings <-  pca_result_t.prism_gastrictreat$rotation  # Loadings (coefficients) of each variable on each principal component
 plot(1:length(pca_variances), pca_variances, type = "b", xlab = "Principal Component", ylab = "Variance Explained",
     main = "Scree Plot")
plot(pca_values[, 1], pca_values[, 2], xlab = "PC1", ylab = "PC2")


###
pca_data <- data.frame(PC1 = pca_values[, 1], PC2 = pca_values[, 2],CellLine = rownames(pca_values) )

bone.cancer.celllines.group<- "red"
kidney.cancer.celllines.group <- "blue"
liver.cancer.celllines.group <- "green"
gastric.cancer.celllines.group<- "purple"
breast.cancer.celllines.group <- "orange"

pca_data$Group <- NA
pca_data$Group[pca_data$CellLine %in% bone.cancer.celllines.v] <- "Bone cancer"
pca_data$Group[pca_data$CellLine %in% kidney.cancer.celllines.v] <- "Kidney cancer"
pca_data$Group[pca_data$CellLine %in% liver.cancer.celllines.v] <- "Liver cancer"
pca_data$Group[pca_data$CellLine %in% gastric.cancer.celllines.v] <- "Gastric cancer"
pca_data$Group[pca_data$CellLine %in% breast.cancer.celllines.v]<-"Breast cancer"

ggplot(pca_data, aes(x = PC1, y = PC2, color = Group)) +
  geom_point() +
  scale_color_manual(values = c("Bone cancer"=bone.cancer.celllines.group, "Kidney cancer"=kidney.cancer.celllines.group, "Liver cancer"=liver.cancer.celllines.group, "Gastric cancer"=gastric.cancer.celllines.group,"Breast cancer"= breast.cancer.celllines.group)) +
  labs(x = "PC1", y = "PC2", title = "PCA Scatter Plot")
```

**K-Means Clustering of the cell lines by using the pca results:**

```{r}
pca_result_prism.exp_geneshv<- prcomp(prism.exp_geneshv)
pca_values <- pca_result_prism.exp_geneshv $x # Principal component scores (transformed data)
pca_variances <- pca_result_prism.exp_geneshv $sdev^2  # Variance explained by each principal component
pca_proportions <- pca_variances / sum(pca_variances)  # Proportion of variance explained by each principal component
pca_loadings <- pca_result_prism.exp_geneshv $rotation  # Loadings (coefficients) of each variable on each principal component
 plot(1:length(pca_variances), pca_variances, type = "b", xlab = "Principal Component", ylab = "Variance Explained",
     main = "Scree Plot")
plot(pca_values[, 1], pca_values[, 2], xlab = "PC1", ylab = "PC2")


###
pca_data <- data.frame(PC1 = pca_values[, 1], PC2 = pca_values[, 2],CellLine = rownames(pca_values) )

bone.cancer.celllines.group<- "red"
kidney.cancer.celllines.group <- "blue"
liver.cancer.celllines.group <- "green"
gastric.cancer.celllines.group<- "purple"
breast.cancer.celllines.group <- "orange"

pca_data$Group <- NA
pca_data$Group[pca_data$CellLine %in% bone.cancer.celllines.v] <- "Bone cancer"
pca_data$Group[pca_data$CellLine %in% kidney.cancer.celllines.v] <- "Kidney cancer"
pca_data$Group[pca_data$CellLine %in% liver.cancer.celllines.v] <- "Liver cancer"
pca_data$Group[pca_data$CellLine %in% gastric.cancer.celllines.v] <- "Gastric cancer"
pca_data$Group[pca_data$CellLine %in% breast.cancer.celllines.v]<-"Breast cancer"

ggplot(pca_data, aes(x = PC1, y = PC2, color = Group)) +
  geom_point() +
  scale_color_manual(values = c("Bone cancer"=bone.cancer.celllines.group, "Kidney cancer"=kidney.cancer.celllines.group, "Liver cancer"=liver.cancer.celllines.group, "Gastric cancer"=gastric.cancer.celllines.group,"Breast cancer"= breast.cancer.celllines.group)) +
  labs(x = "PC1", y = "PC2", title = "PCA Scatter Plot")
# Extract the PC scores
pc_scores.exp <- as.data.frame(pca_result_prism.exp_geneshv$x[, 1:2])

# Perform k-means clustering on the PC scores
kmeans_result <- kmeans(pc_scores, centers = 3)

# Add cluster labels to the PC scores
pc_scores.exp$cluster <- as.factor(kmeans_result$cluster)

# Plot the clustered data
ggplot(pc_scores.exp, aes(PC1, PC2, color = cluster)) +
  geom_point() +
  labs(x = "PC1", y = "PC2", title = "PCA with K-means Clustering")
```

```{r}
library(ggplot2)
library(ggforce)
library(cluster)

# Scatter plot without clustering
ggplot(pca_data, aes(x = PC1, y = PC2, color = Group)) +
  geom_point() +
  scale_color_manual(values = c("Bone cancer" = bone.cancer.celllines.group, "Kidney cancer" = kidney.cancer.celllines.group, "Liver cancer" = liver.cancer.celllines.group, "Gastric cancer" = gastric.cancer.celllines.group, "Breast cancer" = breast.cancer.celllines.group)) +
  labs(x = "PC1", y = "PC2", title = "PCA Scatter Plot")

# Perform PCA
pca_result <- prcomp(pca_data[, c("PC1", "PC2")])

# Extract the PC scores
pc_scores <- as.data.frame(pca_result_prism.exp_geneshv$x[, 1:2])
# Perform k-means clustering on the PC scores
kmeans_result <- kmeans(pc_scores[, c("PC1", "PC2")], centers = 5)

# Add cluster labels to the PC scores
pc_scores$cluster <- as.factor(kmeans_result$cluster)

# Calculate the center and radius of each cluster
cluster_centers <- aggregate(pc_scores[, c("PC1", "PC2")], list(cluster = pc_scores$cluster), mean)
cluster_radii <- aggregate(pc_scores[, c("PC1", "PC2")], list(cluster = pc_scores$cluster), function(x) max(dist(rbind(x, c(0, 0)))))

# Plot the clustered data with circles around each cluster
ggplot(pc_scores, aes(PC1, PC2, color = cluster)) +
  geom_point() +stat_ellipse(geom = "path", aes(group = cluster, color = cluster), alpha = 0.2)+
  labs(x = "PC1", y = "PC2", title = "PCA with K-means Clustering and Circles")
```

 Testing the right amount of clusters:

```{r}
library(cluster)
library(factoextra)
install.packages ("factoextra")


fviz_nbclust(pc_scores.exp, kmeans, method = "wss") + geom_vline(xintercept = 3, linetype=2)

```

```{r}

library(purrr)
library(factoextra)
library(cluster)
#higher values indicates a better clustering
avg_sil <- function(k) {
  km.res <- kmeans(pc_scores.exp, centers = 5, nstart = 25)
  ss <- silhouette(km.res$cluster, dist(pc_scores.exp))
  mean(ss[, 3])
  }
#compute and plot wss for k=2 to k=15
k.values <- 2:15

# extract avg silhouette for 2-15 clusters
avg_sil_values <- map_dbl(k.values, avg_sil)

plot(k.values, avg_sil_values,
       type = "b", pch = 19, frame = FALSE, 
       xlab = "Number of clusters K",
       ylab = "Average Silhouettes")

#computing with silhouette method
fviz_nbclust(pc_scores.exp, kmeans, method = "silhouette")



```

```{r}
pam.res4 <- pam(pc_scores.exp, 3,  metric = "euclidean", stand = FALSE)
fviz_cluster(pam.res4, data = pc_scores.exp, palette = c("#FC4E07", "#00AFBB", "#E7B800","#4C8C33","green"), ellipse.type = "euclid", 
star.plot = TRUE, 
repel = TRUE, 
ggtheme = theme_minimal(), geom = "point" )
fviz_silhouette(pam.res4, palette = "jco", ggtheme = theme_classic())

```

```{r}
pam.res4 <- pam(pc_scores.exp, 5,  metric = "euclidean", stand = FALSE)
fviz_cluster(pam.res4, data = pc_scores.exp, palette = c("#FC4E07", "#00AFBB", "#E7B800","#4C8C33","pink"), ellipse.type = "euclid", 
star.plot = TRUE, 
repel = TRUE, 
ggtheme = theme_minimal(), geom = "point" )
fviz_silhouette(pam.res4, palette = "jco", ggtheme = theme_classic())
```

```{r}
fviz_silhouette(pam.res4, palette = "jco", ggtheme = theme_classic())
#In our case, an average silhouette width of 0.41 indicates a moderate to good separation of data points within their respective clusters. This suggests that the clustering result has some level of distinction and coherence, with a reasonably clear separation between the clusters
 #trying with other numbers:
pam.res2 <- pam(pc_scores.exp, 2,  metric = "euclidean", stand = FALSE)
fviz_cluster(pam.res2, data = pc_scores.exp, palette = c("#FC4E07", "#00AFBB"), ellipse.type = "euclid", 
star.plot = TRUE, 
repel = TRUE, 
ggtheme = theme_minimal(), geom = "point" )

fviz_silhouette(pam.res2, palette = "jco", ggtheme = theme_classic())

```

```{r}
#here we have 0.49, which is even better
#PCA of this reduced data frame: 

standardized_data.p <- scale(prism_cleaned)
pca_result.p <- prcomp(standardized_data.p, scale. = FALSE)
View(pca_result.p)
pcs <- pca_result.p$x
variance_explained <- pca_result.p$sdev^2 / sum(pca_result.p$sdev^2)

loadings <- pca_result.p$rotation
scree_plot <- plot(1:length(variance_explained), variance_explained, type = "b",  xlab = "Principal Component", ylab = "Variance Explained")
```

## **Finding correlation between Target of a treatment and the respectiv gene for that target in cancer cellline:**

Calculating correlation as an example of treatment response to the gene expression of the target of that treatment in the celllines as an example:

```{r}
# Select a column by its name and store it in a vector
column_name <- "MTOR"
vector <- prism.cnv_gastric[[column_name]]
# Select a column by its name and store it in a vector
column_name <- "BRD-A28467416-002-01-0::10::HTS002"
vector1 <- prism_gastric[[column_name]]
```

```{r}
plot(vector, vector1, type = "p", pch = 16, col = "blue",
     xlab = "X", ylab = "Y", main = "Plot of X vs Y")
```

```{r}
# Calculate the correlation
correlation <- cor(vector1, vector)

# Print the correlation
print(correlation)
```

```{r}
# Select a column by its name and store it in a vector
column_name <- "AURKB"
vector2 <- prism.cnv_gastric[[column_name]]
# Select a column by its name and store it in a vector
column_name <- "BRD-K01683783-001-02-6::10::HTS002"
vector3 <- prism_gastric[[column_name]]
```

```{r}
# Calculate the correlation
correlation <- cor(vector2, vector3)

# Print the correlation
print(correlation)
```

**Calculating all correlations of the respective treatment response with respective gene expression of its target in cellines with help of loop of a whole dataframe:**

Dataframe used: Prism with just gastric celllines and selected drugs with Deniz code; Prism.cnv just gastric cellines

```{r}
# Select columns using character variables

cor_prism_gastric <- prism_gastric[pc1_selected_drugs]

```

```{r}
# Create an empty list to store the correlation results
correlation_results <- list()

# Loop through each column of df2 = cor_prism_gastric
for (col in colnames(cor_prism_gastric)) {
  # Get the corresponding row name from df2
  row_name <- col

  # Get the variable (string) from the specified column in df1 = prism.treat
  variable <- as.character(prism.treat[row_name, "target"])

  # Check if the variable exists and is a string
  if (!is.na(variable) && is.character(variable)) {
    # Split the variable into separate strings
    variables <- strsplit(variable, ",")[[1]]

    # Loop through each individual string
    for (var in variables) {
      # Trim leading/trailing whitespace
      var <- trimws(var)

      # Check if the trimmed string is empty
      if (nchar(var) > 0) {
        # Find the matching column name in df3
        df3_col <- var

        # Check if the column name exists in df3 = prism.cnv_gastric
        if (df3_col %in% colnames(prism.cnv_gastric)) {
          # Subset the columns from df2 and df3
          subset_df2 <- cor_prism_gastric[, col]
          subset_df3 <- prism.cnv_gastric[, df3_col]

          # Calculate the correlation
          correlation <- cor(subset_df2, subset_df3)

          # Store the correlation result with a descriptive name
          correlation_results[[paste("Correlation between", col, "and", df3_col)]] <- correlation
        }
      }
    }
  }
}

# Access the correlation results
print(correlation_results)
```

```{r}
# Werte aus der Liste als Vektor extrahieren
valuesb<- unlist(correlation_results)

# Histogramm erstellen
hist(valuesb, col = "blue", main = "Histogramm der Werte", xlab = "Wert", ylab = "Häufigkeit")



```

Dataframe used: Prism with just gastric celllines and all drugs ; Prism.cnv just gastric cellines

```{r}

# Create an empty list to store the correlation results
correlation_results1 <- list()

# Loop through each column of df2 = cor_prism_gastric
for (col in colnames(prism_gastric)) {
  # Get the corresponding row name from df2
  row_name <- col

  # Get the variable (string) from the specified column in df1 = prism.treat
  variable <- as.character(prism.treat[row_name, "target"])

  # Check if the variable exists and is a string
  if (!is.na(variable) && is.character(variable)) {
    # Split the variable into separate strings
    variables <- strsplit(variable, ",")[[1]]

    # Loop through each individual string
    for (var in variables) {
      # Trim leading/trailing whitespace
      var <- trimws(var)

      # Check if the trimmed string is empty
      if (nchar(var) > 0) {
        # Find the matching column name in df3
        df3_col <- var

        # Check if the column name exists in df3 = prism.cnv_gastric
        if (df3_col %in% colnames(prism.cnv_gastric)) {
          # Subset the columns from df2 and df3
          subset_df2 <- prism_gastric[, col]
          subset_df3 <- prism.cnv_gastric[, df3_col]

          # Calculate the correlation
          correlation <- cor(subset_df2, subset_df3)

          # Store the correlation result with a descriptive name
          correlation_results1[[paste("Correlation between", col, "and", df3_col)]] <- correlation
        }
      }
    }
  }
}

# Access the correlation results
print(correlation_results1)
```

```{r}
# NA-Werte aus der Liste entfernen
correlation_results1 <- na.omit(correlation_results1)

```

```{r}
# Werte aus der Liste als Vektor extrahieren
valuesw <- unlist(correlation_results1)

# Histogramm erstellen
hist(valuesw, col = "blue", main = "Histogramm der Werte", xlab = "Wert", ylab = "Häufigkeit")
```

Dataframe used: Prism with all celllines and selected drugs with Deniz code; Prism.cnv but 0 values replaced with mean value

```{r}
# Select columns using character variables

cor_prism <- prism[pc1_selected_drugs]

cor_prismdf <- new_df[pc1_selected_drugs]#-> ohne NA values
```

```{r}

# Create an empty list to store the correlation results
correlation_results6 <- list()

# Loop through each column of df2 = cor_prism_gastric
for (col in colnames(cor_prismdf)) {
  # Get the corresponding row name from df2
  row_name <- col

  # Get the variable (string) from the specified column in df1 = prism.treat
  variable <- as.character(prism.treat[row_name, "target"])

  # Check if the variable exists and is a string
  if (!is.na(variable) && is.character(variable)) {
    # Split the variable into separate strings
    variables <- strsplit(variable, ",")[[1]]

    # Loop through each individual string
    for (var in variables) {
      # Trim leading/trailing whitespace
      var <- trimws(var)

      # Check if the trimmed string is empty
      if (nchar(var) > 0) {
        # Find the matching column name in df3
        df3_col <- var

        # Check if the column name exists in df3 = prism.cnv_gastric
        if (df3_col %in% colnames(new_df2)) {
          # Subset the columns from df2 and df3
          subset_df2 <- cor_prismdf[, col]
          subset_df3 <- new_df2[, df3_col]

          # Calculate the correlation
          correlation <- cor(subset_df2, subset_df3)

          # Store the correlation result with a descriptive name
          correlation_results6[[paste("Correlation between", col, "and", df3_col)]] <- correlation
        }
      }
    }
  }
}


```

```{r}
# NA-Werte aus der Liste entfernen
correlation_results6 <- na.omit(correlation_results6)
```

```{r}
# Werte aus der Liste als Vektor extrahieren
valuese <- unlist(correlation_results6)

# Werte als numerische Werte umwandeln
valuese <- as.numeric(unlist(correlation_results6))

# Histogramm erstellen
hist(valuese, breaks = 10, col = "blue", main = "Histogramm der Werte", xlab = "Wert", ylab = "Häufigkeit")
```

Dataframe used: Prism with all celllines and all drugs but NA values replaced with mean value; Prism.cnv

```{r}

# Create an empty list to store the correlation results
correlation_results2 <- list()

# Loop through each column of df2 = cor_prism_gastric
for (col in colnames(new_df)) {
  # Get the corresponding row name from df2
  row_name <- col

  # Get the variable (string) from the specified column in df1 = prism.treat
  variable <- as.character(prism.treat[row_name, "target"])

  # Check if the variable exists and is a string
  if (!is.na(variable) && is.character(variable)) {
    # Split the variable into separate strings
    variables <- strsplit(variable, ",")[[1]]

    # Loop through each individual string
    for (var in variables) {
      # Trim leading/trailing whitespace
      var <- trimws(var)

      # Check if the trimmed string is empty
      if (nchar(var) > 0) {
        # Find the matching column name in df3
        df3_col <- var

        # Check if the column name exists in df3 = prism.cnv_gastric
        if (df3_col %in% colnames(prism.cnv)) {
          # Subset the columns from df2 and df3
          subset_df2 <- new_df[, col]
          subset_df3 <- prism.cnv[, df3_col]

          # Calculate the correlation
          correlation <- cor(subset_df2, subset_df3)

          # Store the correlation result with a descriptive name
          correlation_results2[[paste("Correlation between", col, "and", df3_col)]] <- correlation
        }
      }
    }
  }
}


```

```{r}
# NA-Werte aus der Liste entfernen
correlation_results2 <- na.omit(correlation_results2)
```

```{r}
# Werte aus der Liste als Vektor extrahieren
valuesc <- unlist(correlation_results2)

# Werte als numerische Werte umwandeln
valuesc <- as.numeric(unlist(correlation_results2))

# Histogramm erstellen
hist(valuesc, breaks = 10, col = "blue", main = "Histogramm der Werte", xlab = "Wert", ylab = "Häufigkeit")
```

```{r}
# NA-Werte entfernen, indem du zuerst die Werte in numerische Werte umwandelst
my_list_numeric <- as.numeric(unlist(correlation_results2))
my_list_cleaned <- na.omit(my_list_numeric)

# Überprüfen, ob NA-Werte erfolgreich entfernt wurden
if (length(my_list_cleaned) > 0) {
  # Histogramm erstellen
  hist(my_list_cleaned, col = "blue", main = "Histogramm der Werte", xlab = "Wert", ylab = "Häufigkeit")
} else {
  print("Die Liste enthält keine gültigen Werte nach Entfernen der NA-Werte.")
}
```

```{r}
# Install and load the "zoo" package
install.packages("zoo")
library(zoo)



# Replace NA values with column means
new_df <- na.aggregate(prism, FUN = mean)

# Print the new dataframe
print(new_df)
```

```{r}
# Replace zeros with column means
new_df1 <- na.aggregate(prism.exp, FUN = function(x) { ifelse(x == 0, mean(x, na.rm = TRUE), x) })

# Print the new dataframe
print(new_df1)

# Replace zeros with column means
new_df2 <- na.aggregate(prism.cnv, FUN = function(x) { ifelse(x == 0, mean(x, na.rm = TRUE), x) })

# Print the new dataframe
print(new_df2)
# Replace zeros with column means
new_df3 <- na.aggregate(prism.achilles, FUN = function(x) { ifelse(x == 0, mean(x, na.rm = TRUE), x) })

# Print the new dataframe
print(prism.achilles)

```

```{r}
# Get the common row names
common_rows <- intersect(row.names(new_df), row.names(prism.exp))

# Create new dataframes with common rows
new_prism <- new_df[common_rows, ]
new_prism.exp <- prism.exp[common_rows, ]

```

Dataframe used: Prism with the same amount of celllines as prism.exp and all drugs but NA values replaced with mean value; Prism.exp with the same amount of celllines as prism

```{r}
# Create an empty list to store the correlation results
correlation_results4 <- list()

# Loop through each column of df2 = cor_prism_gastric
for (col in colnames(new_prism)) {
  # Get the corresponding row name from df2
  row_name <- col

  # Get the variable (string) from the specified column in df1 = prism.treat
  variable <- as.character(prism.treat[row_name, "target"])

  # Check if the variable exists and is a string
  if (!is.na(variable) && is.character(variable)) {
    # Split the variable into separate strings
    variables <- strsplit(variable, ",")[[1]]

    # Loop through each individual string
    for (var in variables) {
      # Trim leading/trailing whitespace
      var <- trimws(var)

      # Check if the trimmed string is empty
      if (nchar(var) > 0) {
        # Find the matching column name in df3
        df3_col <- var

        # Check if the column name exists in df3 = prism.cnv_gastric
        if (df3_col %in% colnames(new_prism.exp)) {
          # Subset the columns from df2 and df3
          subset_df2 <- new_prism[, col]
          subset_df3 <- new_prism.exp[, df3_col]

          # Calculate the correlation
          correlation <- cor(subset_df2, subset_df3)

          # Store the correlation result with a descriptive name
          correlation_results4[[paste("Correlation between", col, "and", df3_col)]] <- correlation
        }
      }
    }
  }
}


```

```{r}
# NA-Werte aus der Liste entfernen
correlation_results4 <- na.omit(correlation_results4)
```

```{r}
# Werte aus der Liste als Vektor extrahieren
valuesch <- unlist(correlation_results4)

# Werte als numerische Werte umwandeln
valuesch <- as.numeric(unlist(correlation_results4))

# Histogramm erstellen
hist(valuesch, breaks = 10, col = "blue", main = "Histogramm der Werte", xlab = "Wert", ylab = "Häufigkeit")
```

Dataframe used: Prism with the same amount of celllines as prism.exp and all drugs but NA values replaced with mean value; Prism.cnv with the same amount of celllines as prism but 0 values replaced with mean value of the column

```{r}
# Get the common row names
common_rows <- intersect(row.names(new_df), row.names(new_df1))

# Create new dataframes with common rows
new_prism <- new_df[common_rows, ]
new_prism.exp1 <- new_df1[common_rows, ]
```

```{r}
# Create an empty list to store the correlation results
correlation_results5 <- list()

# Loop through each column of df2 = cor_prism_gastric
for (col in colnames(new_prism)) {
  # Get the corresponding row name from df2
  row_name <- col

  # Get the variable (string) from the specified column in df1 = prism.treat
  variable <- as.character(prism.treat[row_name, "target"])

  # Check if the variable exists and is a string
  if (!is.na(variable) && is.character(variable)) {
    # Split the variable into separate strings
    variables <- strsplit(variable, ",")[[1]]

    # Loop through each individual string
    for (var in variables) {
      # Trim leading/trailing whitespace
      var <- trimws(var)

      # Check if the trimmed string is empty
      if (nchar(var) > 0) {
        # Find the matching column name in df3
        df3_col <- var

        # Check if the column name exists in df3 = prism.cnv_gastric
        if (df3_col %in% colnames(new_prism.exp1)) {
          # Subset the columns from df2 and df3
          subset_df2 <- new_prism[, col]
          subset_df3 <- new_prism.exp1[, df3_col]

          # Calculate the correlation
          correlation <- cor(subset_df2, subset_df3)

          # Store the correlation result with a descriptive name
          correlation_results5[[paste("Correlation between", col, "and", df3_col)]] <- correlation
        }
      }
    }
  }
}


```

```{r}
# NA-Werte aus der Liste entfernen
correlation_results5 <- na.omit(correlation_results5)
```

```{r}
# Werte aus der Liste als Vektor extrahieren
valuesd <- unlist(correlation_results5)

# Werte als numerische Werte umwandeln
valuesd <- as.numeric(unlist(correlation_results5))

# Histogramm erstellen
hist(valuesd, breaks = 10, col = "blue", main = "Histogramm der Werte", xlab = "Wert", ylab = "Häufigkeit")
```

Dataframe used: Prism with the same amount of celllines as prism.achilles and all drugs but NA values replaced with mean value; Prism.achillws with the same amount of celllines as prism and zero values replaced with mean value

```{r}
# Get the common row names
common_rows <- intersect(row.names(new_df), row.names(new_df3)) #prism;prism.achilles

# Create new dataframes with common rows
new_prism <- new_df[common_rows, ]
new_prism.achilles <- new_df3[common_rows, ]
```

```{r}
# Create an empty list to store the correlation results
correlation_results7 <- list()

# Loop through each column of df2 = cor_prism_gastric
for (col in colnames(new_prism)) {
  # Get the corresponding row name from df2
  row_name <- col

  # Get the variable (string) from the specified column in df1 = prism.treat
  variable <- as.character(prism.treat[row_name, "target"])

  # Check if the variable exists and is a string
  if (!is.na(variable) && is.character(variable)) {
    # Split the variable into separate strings
    variables <- strsplit(variable, ",")[[1]]

    # Loop through each individual string
    for (var in variables) {
      # Trim leading/trailing whitespace
      var <- trimws(var)

      # Check if the trimmed string is empty
      if (nchar(var) > 0) {
        # Find the matching column name in df3
        df3_col <- var

        # Check if the column name exists in df3 = prism.cnv_gastric
        if (df3_col %in% colnames(new_prism.achilles)) {
          # Subset the columns from df2 and df3
          subset_df2 <- new_prism[, col]
          subset_df3 <- new_prism.achilles[, df3_col]

          # Calculate the correlation
          correlation <- cor(subset_df2, subset_df3)

          # Store the correlation result with a descriptive name
          correlation_results7[[paste("Correlation between", col, "and", df3_col)]] <- correlation
        }
      }
    }
  }
}


```

```{r}
# NA-Werte aus der Liste entfernen
correlation_results7 <- na.omit(correlation_results7)
```

```{r}
# Werte aus der Liste als Vektor extrahieren
valuesf <- unlist(correlation_results7)

# Werte als numerische Werte umwandeln
valuesf <- as.numeric(unlist(correlation_results7))

# Histogramm erstellen
hist(valuesf, breaks = 10, col = "blue", main = "Histogramm der Werte", xlab = "Wert", ylab = "Häufigkeit")
```

**Extract maximal correlation value of each correlation list:**

```{r}
#Prism with just gastric celllines and selected drugs with Deniz code; Prism.cnv just gastric cellines
# Find the index of the maximum value in the list
max_index <- which.max(sapply(correlation_results, function(x) x[1]))

# Extract the entry with the maximum value
max_entry <- correlation_results[[max_index]]

# Print the entry with the maximum value
print(max_entry)

# Get the maximum value from max_entry
search_value <- max_entry[1]

# Search for the maximum value in the entry
matching_indices <- grep(search_value, max_entry)

# Extract the value and description using the index
extracted_value <- max_entry[matching_indices]
description <- names(correlation_results)[matching_indices]
# Print the extracted value and description
print(extracted_value)
print(description)
```

```{r}
# Flatten the list to a numeric vector
flat_list <- unlist(correlation_results)

# Calculate the absolute values of the flat list
abs_values <- abs(flat_list)

# Sort the absolute values in descending order
sorted_abs_values <- sort(abs_values, decreasing = TRUE)

# Extract the 10 absolute highest values
highest_abs_values <- sorted_abs_values[1:10]

# Print the 10 absolute highest values
print(highest_abs_values)
```

```{r}
# Select all row names of the dataframe
all_row_names <- row.names(prism.achilles_gastric)
# Filter the dataframe based on the matching row names
filtered_df <- prism_gastric[row.names(prism_gastric) %in% all_row_names, ]


```

```{r}
# Select a column by its name and store it in a vector
column_name <- "BCR"
vector50 <- prism.cnv_gastric[[column_name]]
vector55 <- prism.achilles_gastric[[column_name]]
# Select a column by its name and store it in a vector
column_name <- "BRD-K35329391-334-01-7::10::HTS002"
vector51 <- prism_gastric[[column_name]]
plot(vector50, vector51, type = "p", pch = 16, col = "blue",
     xlab = "BCR", ylab = "BRD-K35329391-334-01-7::10::HTS002", main = "Plot of BCR vs BRD-K35329391-334-01-7::10::HTS002")
# Select a column by its name and store it in a vector
column_name <- "BRD-K35329391-334-01-7::10::HTS002"
vector52 <- filtered_df[[column_name]]
plot(vector55, vector52, type = "p", pch = 16, col = "blue",
     xlab = "BCR", ylab = "BRD-K35329391-334-01-7::10::HTS002", main = "Plot of BCR vs BRD-K35329391-334-01-7::10::HTS002")

# Select a column by its name and store it in a vector
column_name <- "JAK2"
vector40 <- prism.cnv_gastric[[column_name]]
# Select a column by its name and store it in a vector
column_name <- "BRD-K12502280-001-08-0::10::HTS002"
vector41 <- prism_gastric[[column_name]]
plot(vector40, vector41, type = "p", pch = 16, col = "blue",
     xlab = "JAK2", ylab = "BRD-K12502280-001-08-0::10::HTS002", main = "Plot of JAK2 vs BRD-K12502280-001-08-0::10::HTS002")
# Select a column by its name and store it in a vector
column_name <- "RPL10L"
vector30 <- prism.cnv_gastric[[column_name]]
# Select a column by its name and store it in a vector
column_name <- "BRD-A28970875-300-04-9::10::HTS002"
vector31 <- prism_gastric[[column_name]]
plot(vector30, vector31, type = "p", pch = 16, col = "blue",
     xlab = "RPL10L", ylab = "BRD-A28970875-300-04-9::10::HTS002", main = "Plot of RPL10L vs BRD-A28970875-300-04-9::10::HTS002")
```

```{r}
# Set up a color palette
library(RColorBrewer)
colors <- brewer.pal(8, "Set1")

# Plot the scatter plot with enhanced features
plot(vector50, vector51, type = "p", pch = 16, col = colors[1], 
     xlab = "B-cell Domain Receptor (BCR) Expression Level", 
     ylab = "BRD-K35329391-334-01-7::10::HTS002", 
     main = "Scatter Plot of BCR vs BRD-K35329391-334-01-7::10::HTS002",
     xlim = c(min(vector50), max(vector50)), 
     ylim = c(min(vector51), max(vector51)),
     xaxt = "n", yaxt = "n", bty = "n", frame.plot = FALSE)

# Add grid lines
grid(lty = 2, col = "gray")

# Add the linear regression line
abline(regression_model, col = "red")

# Customize point colors and sizes
points(vector50, vector51, pch = 16, col = colors[1], cex = 1.5)

# Add a legend
legend("bottomright", legend = "Group A", pch = 16, col = colors[1], bty = "n")

# Adjust margins and plot dimensions
par(mar = c(5, 5, 4, 4) + 0.1)

library(ggplot2)

# Create a data frame with the variables
data <- data.frame(KDR = vector50, 
                   HTS002 = vector51)

# Create the scatter plot using ggplot2
ggplot(data, aes(x = KDR, y = HTS002)) +
  geom_point(size = 3, color = "blue") +
  geom_smooth(method = "lm", color = "red", se = FALSE) +
  labs(x = "B-cell Domain Receptor (BCR) Expression Level", 
       y = "BRD-K35329391-334-01-7::10::HTS002",
       title = "Scatter Plot of BCR vs BRD-K35329391-334-01-7::10::HTS002") +
  theme_minimal()
```

```{r}
#Scatter plot of all the concentrations of drug prism_gastric BRD-K84564571-001-02-4 and prism.cnv_gastric gene expression of KDR
# Select a column by its name and store it in a vector
column_name <- "BCR"
vector <- prism.cnv_gastric[[column_name]]
# Select a column by its name and store it in a vector
column_name0 <- "BRD-K35329391-334-01-7::0.00061034::HTS002"
vector1 <- prism_gastric[[column_name0]]
column_name1 <- "BRD-K35329391-334-01-7::0.0024414::HTS002"
vector2 <- prism_gastric[[column_name1]]
column_name2 <- "BRD-K35329391-334-01-7::0.00976562::HTS002"
vector3 <- prism_gastric[[column_name2]]
column_name3<- "BRD-K35329391-334-01-7::0.0390625::HTS002"
vector4 <- prism_gastric[[column_name3]]
column_name4 <- "BRD-K35329391-334-01-7::0.15625::HTS002"
vector5 <- prism_gastric[[column_name4]]
column_name5 <- "BRD-K35329391-334-01-7::0.625::HTS002"
vector6 <- prism_gastric[[column_name5]]
column_name6 <- "BRD-K35329391-334-01-7::2.5::HTS002"
vector7 <- prism_gastric[[column_name6]]
column_name7 <- "BRD-K35329391-334-01-7::10::HTS002"
vector8<- prism_gastric[[column_name7]]
# Create a matrix of vectors
vectors <- cbind(vector1, vector2, vector3, vector4, vector5,vector6, vector7, vector8)
par(mar = c(5, 5, 4, 7))
# Plot the vectors
matplot(vector, vectors, type = "p", pch = 16, col = c("blue", "red", "green", "orange", "purple", "pink", "brown", "black"),
        xlab = "BCR", ylab = "BRD-K35329391-334-01-7")
# Get the coordinates for the legend
legend_x <- 1.11  # Adjust the value as needed
legend_y <- 0.5
# Add a legend
legend(legend_x, legend_y, legend = c("0.00061034", "0.0024414", "0.00976562", "0.0390625", "0.15625", "0.625", "2.5", "10"),
       col = c("blue", "red", "green", "orange", "purple", "pink", "brown", "black"), pch = 16,xpd = TRUE, bty = "n")
cor(vector, vectors)
```

```{r}
par(mar = c(5, 5, 4, 7))

# Plot the vectors
matplot(vector, vectors, type = "p", pch = 16,
        col = c("blue", "red", "green", "orange", "purple", "pink", "brown", "black"),
        xlab = "BCR", ylab = "BRD-K35329391-334-01-7",
        main = "Plot of BCR vs BRD-K35329391-334-01-7")

# Increase font size
cex.axis <- 1.2
cex.lab <- 1.4
cex.main <- 1.6

# Add axis labels and adjust font size
x_axis_label <- "BCR"
y_axis_label <- "BRD-K35329391-334-01-7"
xlabel(x_axis_label, cex.axis = cex.axis)
ylabel(y_axis_label, cex.axis = cex.axis)

# Add a title and adjust font size
plot_title <- "Correlation of Vectors"
title(main = plot_title, cex.main = cex.main)

# Get the coordinates for the legend
legend_x <- max(vector) + 0.1
legend_y <- max(vectors) - 0.2

# Add a legend
legend(legend_x, legend_y, legend = c("0.00061034", "0.0024414", "0.00976562", "0.0390625", "0.15625", "0.625", "2.5", "10"),
       col = c("blue", "red", "green", "orange", "purple", "pink", "brown", "black"), pch = 16, cex = cex.axis,
       xpd = TRUE, bty = "n")

# Compute and display correlations
correlations <- cor(vector, vectors)
print(correlations)
```

```{r}
par(mar = c(5, 5, 4, 7))

# Plot the vectors
matplot(vector, vectors, type = "p", pch = 16,
        col = c("blue", "red", "green", "orange", "purple", "pink", "brown", "black"),
        xlab = "BCR", ylab = "BRD-K35329391-334-01-7",
        main = "Plot of BCR vs BRD-K35329391-334-01-7")

# Increase font size
cex.axis <- 1.2
cex.lab <- 1.4
cex.main <- 1.6

# Add axis labels and adjust font size
x_axis_label <- "BCR"
y_axis_label <- "BRD-K35329391-334-01-7"
xlab(x_axis_label)
ylab(y_axis_label)

# Add a title and adjust font size
plot_title <- "Correlation of Vectors"
title(main = plot_title, cex.main = cex.main)

# Get the coordinates for the legend
legend_x <- max(vector) + 0.1
legend_y <- max(vectors) - 0.2

# Add a legend
legend(legend_x, legend_y, legend = c("0.00061034", "0.0024414", "0.00976562", "0.0390625", "0.15625", "0.625", "2.5", "10"),
       col = c("blue", "red", "green", "orange", "purple", "pink", "brown", "black"), pch = 16, cex = cex.axis,
       xpd = TRUE, bty = "n")

# Perform linear regression for each pair of vectors
regression_models <- lapply(1:ncol(vectors), function(i) {
  regression_model <- lm(vectors[, i] ~ vector)
  return(regression_model)
})

# Display the regression results
for (i in 1:length(regression_models)) {
  model <- regression_models[[i]]
  vector_name <- colnames(vectors)[i]
  cat("Linear Regression for", vector_name, ":\n")
  print(summary(model))
  cat("\n")
}
```

```{r}
# Annahme: correlations ist ein Vektor der Korrelationswerte und concentrations ist ein Vektor der entsprechenden Konzentrationen
 concentrations<-c(0.00061034, 0.0024414, 0.00976562, 0.0390625, 0.15625, 0.625, 2.5, 10)
 correlations<- c(-0.06673854, -0.1110465, -0.2421526, -0.486636,-0.3188962, -0.3059542, -0.3707832, -0.6838769)
# Lineare Regression zwischen Korrelationen und Konzentrationen
regression_model <- lm(correlations ~ concentrations)

# Überprüfung der Steigung (slope) der Regressionsgeraden
slope <- regression_model$coefficients[2]

# Überprüfung, ob die Korrelation mit steigender Konzentration abnimmt oder ob der Betrag der Korrelation ansteigt
if (slope < 0) {
  print("Die Korrelation nimmt mit steigender Konzentration ab.")
} else if (slope > 0) {
  print("Der Betrag der Korrelation steigt mit steigender Konzentration an.")
} else {
  print("Es besteht keine klare lineare Beziehung zwischen Korrelation und Konzentration.")
}

cor(concentrations, correlations)

```

```{r}
# Select a column by its name and store it in a vector
column_name <- "BCR"
vector100 <- prism.cnv[[column_name]]
# Select a column by its name and store it in a vector
column_name <- "BRD-K35329391-334-01-7::10::HTS002"
vector101 <- new_df[[column_name]]
plot(vector100, vector101, type = "p", pch = 16, col = "blue",
     xlab = "BCR", ylab = "BRD-K35329391-334-01-7::10::HTS002", main = "Plot of BCR vs BRD-K35329391-334-01-7::10::HTS002")
cor(vector100,vector101)

# Select a column by its name and store it in a vector
column_name <- "JAK2"
vector100 <- prism.cnv[[column_name]]
# Select a column by its name and store it in a vector
column_name <- "BRD-K12502280-001-08-0::10::HTS002"
vector101 <- new_df[[column_name]]
plot(vector100, vector101, type = "p", pch = 16, col = "blue",
     xlab = "JAK2", ylab = "BRD-K12502280-001-08-0::10::HTS002", main = "Plot of JAK2 vs BRD-K12502280-001-08-0::10::HTS002")
cor(vector100,vector101)

# Select a column by its name and store it in a vector
column_name <- "RPL10L"
vector100 <- prism.cnv[[column_name]]
# Select a column by its name and store it in a vector
column_name <- "BRD-A28970875-300-04-9::10::HTS002"
vector101 <- new_df[[column_name]]
plot(vector100, vector101, type = "p", pch = 16, col = "blue",
     xlab = "RPL10L", ylab = "BRD-A28970875-300-04-9::10::HTS002", main = "Plot of RPL10L vs BRD-A28970875-300-04-9::10::HTS002")
cor(vector100,vector101)
```

```{r}
# Flatten the list to a numeric vector
flat_list <- unlist(correlation_results1)

# Calculate the absolute values of the flat list
abs_values <- abs(flat_list)

# Sort the absolute values in descending order
sorted_abs_values <- sort(abs_values, decreasing = TRUE)

# Extract the 10 absolute highest values
highest_abs_values <- sorted_abs_values[1:10]

# Print the 10 absolute highest values
print(highest_abs_values)
```

```{r}
# Select a column by its name and store it in a vector
column_name <- "AURKB"
vector70 <- prism.cnv_gastric[[column_name]]
# Select a column by its name and store it in a vector
column_name <- "BRD-K01683783-001-02-6::0.0024414::HTS002"
vector71 <- prism_gastric[[column_name]]
plot(vector70, vector71, type = "p", pch = 16, col = "blue",
     xlab = "AURKB", ylab = "BRD-K01683783-001-02-6::0.0024414::HTS002", main = "Plot of AURKB vs BRD-K01683783-001-02-6::0.0024414::HTS002")

# Select a column by its name and store it in a vector
column_name <- "MIF"
vector60 <- prism.cnv_gastric[[column_name]]
# Select a column by its name and store it in a vector
column_name <- "BRD-K56483981-342-06-4::0.0390625::HTS002"
vector61 <- prism_gastric[[column_name]]
plot(vector60, vector61, type = "p", pch = 16, col = "blue",
     xlab = "MIF", ylab = "BRD-K56483981-342-06-4::0.0390625::HTS002", main = "Plot of MIF vs BRD-K56483981-342-06-4::0.0390625::HTS002")

```

```{r}
#Dataframe used: Prism with just gastric celllines and all drugs ; Prism.cnv just gastric cellines
# Find the index of the maximum value in the list
max_index <- which.max(sapply(correlation_results1, function(x) x[1]))

# Extract the entry with the maximum value
max_entry <- correlation_results1[[max_index]]

# Print the entry with the maximum value
print(max_entry)

# Get the maximum value from max_entry
search_value <- max_entry[1]

# Search for the maximum value in the entry
matching_indices <- grep(search_value, max_entry)

# Extract the value and description using the index
extracted_value <- max_entry[matching_indices]
description <- names(correlation_results1)[matching_indices]
# Print the extracted value and description
print(extracted_value)
print(description)
```

```{r}
# Flatten the list to a numeric vector
flat_list <- unlist(correlation_results1)

# Sort the flat list in descending order
sorted_list <- sort(flat_list, decreasing = TRUE)

# Extract the 10 highest values
highest_values <- sorted_list[1:10]

# Print the 10 highest values
print(highest_values)

```

```{r}
# Select a column by its name and store it in a vector
column_name <- "KDR"
vector90 <- prism.cnv[[column_name]]
# Select a column by its name and store it in a vector
column_name <- "BRD-K84564571-001-02-4::0.0024414::HTS002"
vector91 <- new_df[[column_name]]
plot(vector90, vector91, type = "p", pch = 16, col = "blue",
     xlab = "KDR", ylab = "BRD-K84564571-001-02-4::0.00976562::HTS002", main = "Plot of KDR vs BRD-K84564571-001-02-4::0.00976562::HTS002")
cor(vector90,vector91)

```

```{r}
# Calculate the correlation between the limited vectors
limited_correlation <- cor(vector80, vector81)

# Specify the threshold for correlation change
threshold <- 0.005  # Adjust the threshold as needed

# Initialize an empty vector to store selected elements
selected_elements <- numeric(0)

# Iterate over the elements of the larger vector
for (i in 1:length(vector90)) {
  modified_vector80 <- c(vector80, vector90[i])
  modified_vector81 <- c(vector81, vector91[i])
  modified_correlation <- cor(modified_vector80, modified_vector81)
  correlation_change <- abs(modified_correlation - limited_correlation)
  
  # Check if the correlation change is below the threshold
  if (correlation_change <= threshold) {
    selected_elements <- c(selected_elements, vector80[i])
  } else {
    break  # Exit the loop if correlation change exceeds the threshold
  }
}

# Add the selected elements to the limited vectors
updated_vector80 <- c(vector80, selected_elements)
updated_vector81 <- c(vector81, selected_elements)
```

```{r}
# Calculate the correlation between the limited vectors
limited_correlation <- cor(vector80, vector2)

# Specify the threshold for correlation change
threshold <- 0.25 # Adjust the threshold as needed

# Initialize an empty vector to store selected elements
selected_elements <- numeric(0)

# Iterate over the elements of the larger vector90
for (i in 1:length(vector90)) {
  modified_vector80 <- c(vector80, vector90[i])
  modified_vector81 <- c(vector2, vector91[i])
  modified_correlation <- cor(modified_vector80, modified_vector81)
  correlation_change <- abs(modified_correlation - limited_correlation)
  
  # Check if the correlation change is below the threshold
  if (correlation_change <= threshold) {
    selected_elements <- c(selected_elements, i)
  } else {
    break  # Exit the loop if correlation change exceeds the threshold
  }
}

# Add the selected elements to the limited vectors
updated_vector80 <- c(vector80, vector90[selected_elements])
updated_vector81 <- c(vector2, vector91[selected_elements])
```

```{r}

plot(updated_vector80,updated_vector81, type = "p", pch = 16, col = "blue",
     xlab = "KDR", ylab = "BRD-K84564571-001-02-4::0.00976562::HTS002", main = "Plot of KDR vs BRD-K84564571-001-02-4::0.00976562::HTS002")
cor(updated_vector80,updated_vector81)
```

```{r}
# Perform linear regression
regression_model <- lm(vector81 ~ vector2)

# Plot the scatter plot
plot(vector80, vector2, type = "p", pch = 16, col = "blue",
     xlab = "KDR", ylab = "BRD-K84564571-001-02-4::0.00976562::HTS002", 
     main = "Plot of KDR vs BRD-K84564571-001-02-4::0.00976562::HTS002")

# Add the linear regression line
abline(regression_model, col = "red")
```

```{r}
# Set up a color palette
library(RColorBrewer)
colors <- brewer.pal(8, "Set1")

# Plot the scatter plot with enhanced features
plot(vector80, vector2, type = "p", pch = 16, col = colors[1], 
     xlab = "Kinase Domain Receptor (KDR) Expression Level", 
     ylab = "BRD-K84564571-001-02-4::0.00976562::HTS002", 
     main = "Scatter Plot of KDR vs BRD-K84564571-001-02-4::0.00976562::HTS002",
     xlim = c(min(vector80), max(vector80)), 
     ylim = c(min(vector2), max(vector2)),
     xaxt = "n", yaxt = "n", bty = "n", frame.plot = FALSE)

# Add grid lines
grid(lty = 2, col = "gray")

# Add the linear regression line
abline(regression_model, col = "red")

# Customize point colors and sizes
points(vector80, vector2, pch = 16, col = colors[1], cex = 1.5)

# Add a legend
legend("bottomright", legend = "Group A", pch = 16, col = colors[1], bty = "n")

# Adjust margins and plot dimensions
par(mar = c(5, 5, 4, 4) + 0.1)

library(ggplot2)

# Create a data frame with the variables
data <- data.frame(KDR = vector80, 
                   HTS002 = vector2)

# Create the scatter plot using ggplot2
ggplot(data, aes(x = KDR, y = HTS002)) +
  geom_point(size = 3, color = "blue") +
  geom_smooth(method = "lm", color = "red", se = FALSE) +
  labs(x = "Kinase Domain Receptor (KDR) Expression Level", 
       y = "BRD-K84564571-001-02-4::0.00976562::HTS002",
       title = "Scatter Plot of KDR vs BRD-K84564571-001-02-4::0.00976562::HTS002") +
  theme_minimal()
```

```{r}
# Set up a color palette
library(RColorBrewer)
colors <- brewer.pal(8, "Set1")

# Plot the scatter plot with enhanced features
plot(updated_vector80, updated_vector81, type = "p", pch = 16, col = colors[1], 
     xlab = "Kinase Domain Receptor (KDR) Expression Level", 
     ylab = "BRD-K84564571-001-02-4::0.00976562::HTS002", 
     main = "Scatter Plot of KDR vs BRD-K84564571-001-02-4::0.00976562::HTS002",
     xlim = c(min(updated_vector80), max(updated_vector80)), 
     ylim = c(min(updated_vector81), max(updated_vector81)),
     xaxt = "n", yaxt = "n", bty = "n", frame.plot = FALSE)

# Add grid lines
grid(lty = 2, col = "gray")

# Add the linear regression line
abline(regression_model, col = "red")

# Customize point colors and sizes
points(updated_vector80, updated_vector81, pch = 16, col = colors[1], cex = 1.5)

# Add a legend
legend("bottomright", legend = "Group A", pch = 16, col = colors[1], bty = "n")

# Adjust margins and plot dimensions
par(mar = c(5, 5, 4, 4) + 0.1)

library(ggplot2)

# Create a data frame with the variables
data <- data.frame(KDR = updated_vector80, 
                   HTS002 = updated_vector81)

# Create the scatter plot using ggplot2
ggplot(data, aes(x = KDR, y = HTS002)) +
  geom_point(size = 3, color = "blue") +
  geom_smooth(method = "lm", color = "red", se = FALSE) +
  labs(x = "Kinase Domain Receptor (KDR) Expression Level", 
       y = "BRD-K84564571-001-02-4::0.00976562::HTS002",
       title = "Scatter Plot of KDR vs BRD-K84564571-001-02-4::0.00976562::HTS002") +
  theme_minimal()
```

```{r}
# Perform linear regression
regression_model <- lm(vector81 ~ vector80)

# Make predictions using new data
predicted_values <- predict(regression_model, newdata = data.frame(vector80))
# Obtain the residuals
residuals <- residuals(regression_model)

# Create a residual plot
plot(predicted_values, residuals, pch = 16, col = "blue",
     xlab = "Predicted Values", ylab = "Residuals",
     main = "Residual Plot")
```

```{r}
plot(vector80, vector2, type = "p", pch = 16, col = "blue",
     xlab = "KDR", ylab = "BRD-K84564571-001-02-4::0.00976562::HTS002", main = "Plot of KDR vs BRD-K84564571-001-02-4::0.00976562::HTS002")
cor(vector80, vector2)
```

```{r}
#Scatter plot of all the concentrations of drug prism_gastric BRD-K84564571-001-02-4 and prism.cnv_gastric gene expression of KDR
# Select a column by its name and store it in a vector
column_name <- "KDR"
vector <- prism.cnv_gastric[[column_name]]
# Select a column by its name and store it in a vector
column_name0 <- "BRD-K84564571-001-02-4::0.00061034::HTS002"
vector1 <- prism_gastric[[column_name0]]
column_name1 <- "BRD-K84564571-001-02-4::0.0024414::HTS002"
vector2 <- prism_gastric[[column_name1]]
column_name2 <- "BRD-K84564571-001-02-4::0.00976562::HTS002"
vector3 <- prism_gastric[[column_name2]]
column_name3<- "BRD-K84564571-001-02-4::0.0390625::HTS002"
vector4 <- prism_gastric[[column_name3]]
column_name4 <- "BRD-K84564571-001-02-4::0.15625::HTS002"
vector5 <- prism_gastric[[column_name4]]
column_name5 <- "BRD-K84564571-001-02-4::0.625::HTS002"
vector6 <- prism_gastric[[column_name5]]
column_name6 <- "BRD-K84564571-001-02-4::2.5::HTS002"
vector7 <- prism_gastric[[column_name6]]
column_name7 <- "BRD-K84564571-001-02-4::10::HTS002"
vector8<- prism_gastric[[column_name7]]
# Create a matrix of vectors
vectors <- cbind(vector1, vector2, vector3, vector4, vector5,vector6, vector7, vector8)
par(mar = c(5, 5, 4, 7))
# Plot the vectors
matplot(vector, vectors, type = "p", pch = 16, col = c("blue", "red", "green", "orange", "purple", "pink", "brown", "black"),
        xlab = "KDR", ylab = "BRD-K84564571-001-02-4")
# Get the coordinates for the legend
legend_x <- 1.11  # Adjust the value as needed
legend_y <- 0.5
# Add a legend
legend(legend_x, legend_y, legend = c("0.00061034", "0.0024414", "0.00976562", "0.0390625", "0.15625", "0.625", "2.5", "10"),
       col = c("blue", "red", "green", "orange", "purple", "pink", "brown", "black"), pch = 16,xpd = TRUE, bty = "n")

```

```{r}
cor(vector, vectors)

```

```{r}
#Dataframe used: Prism with all celllines and all drugs but NA values replaced with mean value; Prism.cnv 
# Find the index of the maximum value in the list
max_index <- which.max(sapply(correlation_results2, function(x) x[1]))

# Extract the entry with the maximum value
max_entry <- correlation_results2[[max_index]]

# Print the entry with the maximum value
print(max_entry)

# Get the maximum value from max_entry
search_value <- max_entry[1]

# Search for the maximum value in the entry
matching_indices <- grep(search_value, max_entry)

# Extract the value and description using the index
extracted_value <- max_entry[matching_indices]
description <- names(correlation_results2)[matching_indices]
# Print the extracted value and description
print(extracted_value)
print(description)

```

```{r}
#Dataframe used: Prism with the same amount of celllines as prism.exp and all drugs but NA values replaced with mean value; Prism.exp with the same amount of celllines as prism
# Find the index of the maximum value in the list
max_index <- which.max(sapply(correlation_results4, function(x) x[1]))

# Extract the entry with the maximum value
max_entry <- correlation_results4[[max_index]]

# Print the entry with the maximum value
print(max_entry)

# Get the maximum value from max_entry
search_value <- max_entry[1]

# Search for the maximum value in the entry
matching_indices <- grep(search_value, max_entry)

# Extract the value and description using the index
extracted_value <- max_entry[matching_indices]
description <- names(correlation_results4)[matching_indices]
# Print the extracted value and description
print(extracted_value)
print(description)
```

```{r}
#Dataframe used: Prism with the same amount of celllines as prism.exp and all drugs but NA values replaced with mean value; Prism.cnv with the same amount of celllines as prism but 0 values replaced with mean value of the column
# Find the index of the maximum value in the list
max_index <- which.max(sapply(correlation_results5, function(x) x[1]))

# Extract the entry with the maximum value
max_entry <- correlation_results5[[max_index]]

# Print the entry with the maximum value
print(max_entry)

# Get the maximum value from max_entry
search_value <- max_entry[1]

# Search for the maximum value in the entry
matching_indices <- grep(search_value, max_entry)

# Extract the value and description using the index
extracted_value <- max_entry[matching_indices]
description <- names(correlation_results5)[matching_indices]
# Print the extracted value and description
print(extracted_value)
print(description)
```

```{r}
#Dataframe used: Prism with all celllines and selected drugs with Deniz code; Prism.cnv but 0 values replaced with mean value
# Find the index of the maximum value in the list
max_index <- which.max(sapply(correlation_results6, function(x) x[1]))

# Extract the entry with the maximum value
max_entry <- correlation_results6[[max_index]]

# Print the entry with the maximum value
print(max_entry)

# Get the maximum value from max_entry
search_value <- max_entry[1]

# Search for the maximum value in the entry
matching_indices <- grep(search_value, max_entry)

# Extract the value and description using the index
extracted_value <- max_entry[matching_indices]
description <- names(correlation_results6)[matching_indices]
# Print the extracted value and description
print(extracted_value)
print(description)
```

```{r}
#Dataframe used: Prism with the same amount of celllines as prism.achilles and all drugs but NA values replaced with mean value; Prism.achillws with the same amount of celllines as prism and zero values replaced with mean value
# Find the index of the maximum value in the list
max_index <- which.max(sapply(correlation_results7, function(x) x[1]))

# Extract the entry with the maximum value
max_entry <- correlation_results7[[max_index]]

# Print the entry with the maximum value
print(max_entry)

# Get the maximum value from max_entry
search_value <- max_entry[1]

# Search for the maximum value in the entry
matching_indices <- grep(search_value, max_entry)

# Extract the value and description using the index
extracted_value <- max_entry[matching_indices]
description <- names(correlation_results7)[matching_indices]
# Print the extracted value and description
print(extracted_value)
print(description)
```

**Linear Regression**

```{r}
install.packages("dplyr")   # Install the dplyr package
install.packages("ggplot2") # Install the ggplot2 package

library(dplyr)   # Load the dplyr package
library(ggplot2) # Load the ggplot2 package

lm_model <- lm(vector80~ vector2)
```

```{r}
data_df <- data.frame(vector80, vector2) 
lm_model <- lm(vector80~ vector2,data = data_df)
summary(lm_model)
new_data_df <- data.frame(x = vector12) 
predictions <- predict(lm_model, newdata = new_data_df)
ggplot(data = data_df, aes(x = vector80, y = vector2)) +
  geom_point() +
  geom_line(data = new_data_df, aes(y = predictions), color = "red")
```

```{r}
range(vector80)
start <- 0.68      # Start value of the range
end <- 1.09     # End value of the range
distance <- 0.025  # Distance between values

vector12 <- seq(start, end, by = distance)  # Create the vector

```
